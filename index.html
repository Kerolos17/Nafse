<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0a0a0f" />
    <title>Ù†Ø§ÙØ³ AI</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0a0a0f;
        --surface: #111118;
        --surface2: #1a1a25;
        --border: #2a2a3a;
        --accent: #6c63ff;
        --gold: #f5c842;
        --green: #36d399;
        --red: #ff6584;
        --text: #e8e8f0;
        --muted: #6b6b85;
        --nav-h: 64px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      html,
      body {
        height: 100%;
        overflow: hidden;
      }
      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Cairo", sans-serif;
        font-size: 15px;
      }
      #app {
        display: flex;
        flex-direction: column;
        height: 100dvh;
      }
      #topbar {
        flex-shrink: 0;
        height: 56px;
        background: rgba(10, 10, 15, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 16px;
        z-index: 50;
      }
      #content {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }
      #navbar {
        flex-shrink: 0;
        height: var(--nav-h);
        background: rgba(10, 10, 15, 0.97);
        backdrop-filter: blur(20px);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: stretch;
        z-index: 50;
      }
      .nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 3px;
        cursor: pointer;
        color: var(--muted);
        font-size: 10px;
        font-weight: 700;
        transition: color 0.2s;
        border: none;
        background: transparent;
        padding: 8px 4px;
        position: relative;
        font-family: "Cairo", sans-serif;
      }
      .nav-item .icon {
        font-size: 22px;
        line-height: 1;
      }
      .nav-item.active {
        color: var(--accent);
      }
      .nav-item.active::before {
        content: "";
        position: absolute;
        top: 0;
        left: 20%;
        right: 20%;
        height: 2px;
        background: var(--accent);
        border-radius: 0 0 4px 4px;
      }
      .page {
        display: none;
        padding: 16px;
      }
      .page.active {
        display: block;
        animation: fadeUp 0.3s ease;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 12px;
        position: relative;
        overflow: hidden;
      }
      .card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(108, 99, 255, 0.04),
          transparent 60%
        );
        pointer-events: none;
      }
      .btn {
        border: none;
        border-radius: 12px;
        font-family: "Cairo", sans-serif;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        color: white;
        padding: 13px 20px;
        font-size: 15px;
        width: 100%;
        box-shadow: 0 4px 16px rgba(108, 99, 255, 0.35);
      }
      .btn-primary:active {
        transform: scale(0.97);
      }
      .btn-primary:disabled {
        opacity: 0.5;
      }
      .btn-sm {
        background: var(--surface2);
        color: var(--muted);
        border: 1px solid var(--border);
        padding: 7px 14px;
        font-size: 12px;
      }
      .btn-sm:active {
        background: var(--border);
      }
      .btn-icon {
        background: var(--surface2);
        border: 1px solid var(--border);
        padding: 8px 14px;
        font-size: 16px;
        color: var(--text);
      }
      input,
      textarea,
      select {
        background: var(--surface2);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 12px;
        padding: 12px 14px;
        font-family: "Cairo", sans-serif;
        font-size: 14px;
        width: 100%;
        outline: none;
        transition: border-color 0.2s;
        -webkit-appearance: none;
      }
      input:focus,
      textarea:focus {
        border-color: var(--accent);
      }
      input::placeholder,
      textarea::placeholder {
        color: var(--muted);
      }
      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 12px;
      }
      .stat-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px 12px;
        text-align: center;
      }
      .stat-num {
        font-family: "Tajawal", sans-serif;
        font-weight: 900;
        font-size: 28px;
        line-height: 1;
      }
      .stat-label {
        font-size: 11px;
        color: var(--muted);
        margin-top: 3px;
      }
      .ring-wrap {
        position: relative;
        display: inline-block;
      }
      .ring-svg {
        transform: rotate(-90deg);
      }
      .ring-circle {
        transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        stroke-linecap: round;
      }
      .ring-label {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .lbar {
        height: 5px;
        background: var(--surface2);
        border-radius: 100px;
        overflow: hidden;
        margin-top: 8px;
      }
      .lbar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), #8b5cf6);
        border-radius: 100px;
        transition: width 0.8s ease;
      }
      .habit-row {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 13px 14px;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 13px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s;
        user-select: none;
        -webkit-user-select: none;
      }
      .habit-row.done {
        border-color: rgba(54, 211, 153, 0.35);
        background: rgba(54, 211, 153, 0.06);
      }
      .habit-check {
        width: 26px;
        height: 26px;
        border-radius: 7px;
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: all 0.25s;
        font-size: 13px;
      }
      .habit-row.done .habit-check {
        background: var(--green);
        border-color: var(--green);
      }
      .work-task {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-bottom: 8px;
        transition: all 0.2s;
      }
      .work-task.done {
        opacity: 0.6;
        border-color: var(--green);
      }
      .work-task.priority-high {
        border-left: 3px solid var(--red);
      }
      .work-task.priority-medium {
        border-left: 3px solid var(--gold);
      }
      .work-task.priority-low {
        border-left: 3px solid var(--green);
      }
      .task-header {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .task-check {
        width: 22px;
        height: 22px;
        border-radius: 6px;
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 12px;
      }
      .work-task.done .task-check {
        background: var(--green);
        border-color: var(--green);
      }
      .task-title {
        flex: 1;
        font-weight: 600;
        font-size: 14px;
      }
      .task-priority {
        font-size: 18px;
        flex-shrink: 0;
      }
      .task-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 11px;
        color: var(--muted);
        padding-left: 30px;
      }
      .task-time {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .task-timer-btn {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 3px 8px;
        font-size: 10px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .task-timer-btn:active {
        background: var(--border);
      }
      .task-timer-btn.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }
      .mood-row {
        display: flex;
        gap: 8px;
        justify-content: space-between;
      }
      .mood-btn {
        flex: 1;
        font-size: 24px;
        padding: 10px 4px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        border: 1px solid transparent;
        background: var(--surface2);
      }
      .mood-btn.selected {
        border-color: var(--accent);
        background: rgba(108, 99, 255, 0.12);
        transform: scale(1.08);
      }
      #chatMsgs {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 12px 12px 4px;
      }
      .bubble {
        max-width: 88%;
        padding: 12px 14px;
        border-radius: 16px;
        font-size: 14px;
        line-height: 1.75;
        word-break: break-word;
        animation: bubIn 0.25s ease;
      }
      @keyframes bubIn {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(6px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .bubble.ai {
        background: var(--surface2);
        border: 1px solid var(--border);
        border-bottom-right-radius: 4px;
        align-self: flex-end;
      }
      .bubble.user {
        background: linear-gradient(135deg, var(--accent), #8b5cf6);
        color: #fff;
        border-bottom-left-radius: 4px;
        align-self: flex-start;
      }
      .typing-dots {
        display: inline-flex;
        gap: 4px;
        padding: 4px 0;
      }
      .dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--muted);
        animation: blink 1.2s infinite;
      }
      .dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .dot:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes blink {
        0%,
        60%,
        100% {
          opacity: 0.3;
          transform: translateY(0);
        }
        30% {
          opacity: 1;
          transform: translateY(-5px);
        }
      }
      .chips {
        display: flex;
        gap: 7px;
        overflow-x: auto;
        padding: 0 12px 10px;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .chips::-webkit-scrollbar {
        display: none;
      }
      .chip {
        flex-shrink: 0;
        padding: 7px 13px;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 100px;
        font-family: "Cairo", sans-serif;
        font-size: 12px;
        font-weight: 600;
        color: var(--muted);
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
      }
      .chip:active {
        background: rgba(108, 99, 255, 0.15);
        border-color: var(--accent);
        color: var(--accent);
      }
      .cal-grid {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        gap: 4px;
      }
      .cal-cell {
        aspect-ratio: 1;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--surface2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        font-weight: 700;
        color: var(--muted);
      }
      .cal-cell.today {
        border-color: var(--accent);
        color: var(--accent);
      }
      .cal-cell.done {
        background: rgba(54, 211, 153, 0.18);
        border-color: rgba(54, 211, 153, 0.45);
        color: var(--green);
      }
      .cal-cell.partial {
        background: rgba(245, 200, 66, 0.12);
        border-color: rgba(245, 200, 66, 0.35);
        color: var(--gold);
      }
      .cal-cell.future {
        opacity: 0.3;
      }
      .sec-title {
        font-weight: 700;
        font-size: 15px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .day-badge {
        font-family: "Tajawal", sans-serif;
        font-size: 13px;
        color: var(--accent);
        font-weight: 900;
        background: rgba(108, 99, 255, 0.12);
        border: 1px solid rgba(108, 99, 255, 0.25);
        border-radius: 8px;
        padding: 2px 10px;
      }
      #toast {
        position: fixed;
        bottom: calc(var(--nav-h)+12px);
        left: 50%;
        transform: translateX(-50%) translateY(80px);
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 11px 20px;
        font-size: 13px;
        font-weight: 700;
        z-index: 9999;
        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        white-space: nowrap;
      }
      #content::-webkit-scrollbar {
        width: 3px;
      }
      #content::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 2px;
      }
      .timer-big {
        font-family: "Tajawal", sans-serif;
        font-size: 48px;
        font-weight: 900;
        color: var(--accent);
        text-align: center;
        letter-spacing: 2px;
      }
      .api-notice {
        background: rgba(108, 99, 255, 0.08);
        border: 1px solid rgba(108, 99, 255, 0.2);
        border-radius: 12px;
        padding: 12px 14px;
        font-size: 12px;
        line-height: 1.7;
        color: var(--muted);
        margin-top: 8px;
      }
      @keyframes flame {
        from {
          transform: scale(1) rotate(-2deg);
        }
        to {
          transform: scale(1.1) rotate(2deg);
        }
      }
      .flame {
        display: inline-block;
        animation: flame 1.5s ease-in-out infinite alternate;
      }
      #setup {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 200;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 24px;
        overflow-y: auto;
      }
      #setup .si {
        width: 100%;
        max-width: 400px;
      }
    </style>
  </head>
  <body>
    <!-- SETUP -->
    <div id="setup">
      <div class="si">
        <div style="text-align: center; margin-bottom: 28px">
          <div style="font-size: 48px; margin-bottom: 8px">ğŸ§ </div>
          <h1
            style="
              font-family: &quot;Tajawal&quot;, sans-serif;
              font-size: 32px;
              font-weight: 900;
            "
          >
            Ù†Ø§ÙØ³ <span style="color: var(--accent)">AI</span>
          </h1>
          <p style="color: var(--muted); margin-top: 4px; font-size: 14px">
            Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„Ù€ 90 ÙŠÙˆÙ…
          </p>
        </div>
        <div class="card">
          <div class="sec-title" style="margin-bottom: 16px">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ğŸš€</div>
          <div style="margin-bottom: 12px">
            <label
              style="
                font-size: 12px;
                color: var(--muted);
                font-weight: 700;
                display: block;
                margin-bottom: 6px;
              "
              >Ø§Ø³Ù…Ùƒ</label
            ><input type="text" id="sName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø£Ø­Ù…Ø¯" />
          </div>
          <div style="margin-bottom: 12px">
            <label
              style="
                font-size: 12px;
                color: var(--muted);
                font-weight: 700;
                display: block;
                margin-bottom: 6px;
              "
              >Ù‡Ø¯ÙÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label
            ><input
              type="text"
              id="sGoal"
              placeholder="Ù…Ø«Ù„Ø§Ù‹: WordPress Developer Ù…Ø­ØªØ±Ù"
            />
          </div>
          <div style="margin-bottom: 12px">
            <label
              style="
                font-size: 12px;
                color: var(--muted);
                font-weight: 700;
                display: block;
                margin-bottom: 6px;
              "
              >ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label
            ><input type="date" id="sDate" />
          </div>
          <div style="margin-bottom: 16px">
            <label
              style="
                font-size: 12px;
                color: var(--muted);
                font-weight: 700;
                display: block;
                margin-bottom: 6px;
              "
              >ğŸ”‘ Anthropic API Key
              <span style="font-weight: 400; opacity: 0.7"
                >(Ù„Ù„Ù€ AI â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span
              ></label
            >
            <input
              type="password"
              id="sApiKey"
              placeholder="sk-ant-api03-..."
            />
            <div class="api-notice">
              ğŸ”’ Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ø¨Ø³ ÙˆÙ…Ø´ Ø¨ÙŠØªØ¨Ø¹Øª Ù„Ø£ÙŠ Ù…ÙƒØ§Ù†.<br />Ø¬ÙŠØ¨ Ø§Ù„Ù€ Key Ù…Ù†:
              <strong style="color: var(--accent)"
                >console.anthropic.com</strong
              >
              â† API Keys<br />Ù„Ùˆ Ù…Ø´ Ø¹Ù†Ø¯Ùƒ KeyØŒ Ø§Ù„Ù€ App Ù‡ÙŠØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† AI.
            </div>
          </div>
          <button class="btn btn-primary" onclick="startJourney()">
            Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© ğŸ”¥
          </button>
        </div>
        <p
          style="
            text-align: center;
            font-size: 11px;
            color: var(--muted);
            margin-top: 12px;
          "
        >
          ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· ğŸ”’
        </p>
      </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" style="display: none">
      <div id="topbar">
        <div style="display: flex; align-items: center; gap: 8px">
          <span style="font-size: 20px">ğŸ§ </span>
          <span
            style="
              font-family: &quot;Tajawal&quot;, sans-serif;
              font-weight: 900;
              font-size: 18px;
            "
            >Ù†Ø§ÙØ³ <span style="color: var(--accent)">AI</span></span
          >
        </div>
        <div style="display: flex; align-items: center; gap: 8px">
          <span class="flame">ğŸ”¥</span>
          <span
            id="hStreak"
            style="
              font-family: &quot;Tajawal&quot;, sans-serif;
              font-weight: 900;
              font-size: 18px;
              color: var(--gold);
            "
            >0</span
          >
          <span
            id="hName"
            style="
              font-size: 12px;
              color: var(--muted);
              max-width: 70px;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            "
          ></span>
        </div>
      </div>

      <div id="content">
        <!-- HOME -->
        <div class="page active" id="page-home">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 14px;
            "
          >
            <div>
              <p style="font-size: 12px; color: var(--muted)" id="greet">
                ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ğŸ‘‹
              </p>
              <p
                style="
                  font-size: 20px;
                  font-weight: 900;
                  font-family: &quot;Tajawal&quot;, sans-serif;
                "
                id="welcomeMsg"
              >
                Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„
              </p>
            </div>
            <div style="text-align: left">
              <p style="font-size: 10px; color: var(--muted)">Ø§Ù„ÙŠÙˆÙ…</p>
              <p
                style="
                  font-family: &quot;Tajawal&quot;, sans-serif;
                  font-weight: 900;
                  font-size: 32px;
                  color: var(--accent);
                  line-height: 1;
                "
                id="dayNum"
              >
                1
              </p>
              <p style="font-size: 10px; color: var(--muted)">Ù…Ù† 90</p>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-num" style="color: var(--accent)" id="sStreak">
                0
              </div>
              <div class="stat-label">ğŸ”¥ streak</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--green)" id="sDone">
                0
              </div>
              <div class="stat-label">âœ… Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--gold)" id="sPct">
                0%
              </div>
              <div class="stat-label">ğŸ“Š Ø¥Ù†Ø¬Ø§Ø² Ø¹Ø§Ù…</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--red)" id="sRemain">
                90
              </div>
              <div class="stat-label">ğŸ“… ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</div>
            </div>
          </div>
          <div
            class="card"
            style="display: flex; align-items: center; gap: 16px"
          >
            <div class="ring-wrap">
              <svg width="80" height="80" class="ring-svg">
                <circle
                  cx="40"
                  cy="40"
                  r="32"
                  fill="none"
                  stroke="var(--surface2)"
                  stroke-width="8"
                />
                <circle
                  id="todayRing"
                  cx="40"
                  cy="40"
                  r="32"
                  fill="none"
                  stroke="var(--green)"
                  stroke-width="8"
                  stroke-dasharray="201"
                  stroke-dashoffset="201"
                  class="ring-circle"
                />
              </svg>
              <div class="ring-label">
                <span
                  style="
                    font-family: &quot;Tajawal&quot;, sans-serif;
                    font-weight: 900;
                    font-size: 16px;
                  "
                  id="todayPct"
                  >0%</span
                >
              </div>
            </div>
            <div style="flex: 1">
              <p style="font-size: 12px; color: var(--muted)">ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…</p>
              <p
                style="font-weight: 700; font-size: 14px; margin: 4px 0"
                id="phName"
              >
                Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1
              </p>
              <p style="font-size: 11px; color: var(--muted)" id="phDesc">
                PHP + WordPress Core
              </p>
              <div class="lbar">
                <div class="lbar-fill" id="phBar" style="width: 0%"></div>
              </div>
              <p
                style="font-size: 10px; color: var(--muted); margin-top: 4px"
                id="phProg"
              >
                0 / 30 ÙŠÙˆÙ…
              </p>
            </div>
          </div>
          <div class="card" style="border-color: rgba(108, 99, 255, 0.25)">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 10px;
              "
            >
              <div style="display: flex; align-items: center; gap: 8px">
                <span style="font-size: 18px">ğŸ¤–</span
                ><span style="font-weight: 700; font-size: 13px"
                  >ØªØ­Ù„ÙŠÙ„ AI Ù„Ø£Ø¯Ø§Ø¦Ùƒ</span
                >
              </div>
              <button class="btn btn-sm" onclick="genInsight()" id="insightBtn">
                ØªØ­Ù„ÙŠÙ„
              </button>
            </div>
            <div
              id="insightTxt"
              style="font-size: 13px; color: var(--muted); line-height: 1.75"
            >
              Ø§Ø¶ØºØ· "ØªØ­Ù„ÙŠÙ„" Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ AI ÙŠØ´ÙˆÙ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ğŸ’¡
            </div>
          </div>
          <div class="card">
            <div class="sec-title">ğŸ“… Ø§Ù„Ù€ 90 ÙŠÙˆÙ…</div>
            <div class="cal-grid" id="calGrid"></div>
            <div style="display: flex; gap: 12px; margin-top: 10px">
              <span style="font-size: 10px; color: var(--green)">â— Ù…ÙƒØªÙ…Ù„</span>
              <span style="font-size: 10px; color: var(--gold)">â— Ø¬Ø²Ø¦ÙŠ</span>
              <span style="font-size: 10px; color: var(--muted)"
                >â— Ù„Ù… ÙŠÙØ³Ø¬ÙÙ‘Ù„</span
              >
            </div>
          </div>
        </div>

        <!-- TODAY -->
        <div class="page" id="page-today">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 14px;
            "
          >
            <div>
              <p
                style="
                  font-weight: 900;
                  font-size: 20px;
                  font-family: &quot;Tajawal&quot;, sans-serif;
                "
              >
                â˜€ï¸ ÙŠÙˆÙ… Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡
              </p>
              <p
                style="font-size: 12px; color: var(--muted)"
                id="todayDateTxt"
              ></p>
            </div>
            <div class="day-badge" id="todayDayBadge">ÙŠÙˆÙ… 1</div>
          </div>
          <div class="card">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 10px;
              "
            >
              <div class="sec-title" style="margin-bottom: 0">âœ… Ø§Ù„Ù…Ù‡Ø§Ù…</div>
              <span
                style="font-size: 13px; font-weight: 700; color: var(--green)"
                id="habCount"
                >0/0</span
              >
            </div>
            <div id="habList"></div>
            <button
              class="btn btn-sm"
              style="width: 100%; margin-top: 8px; justify-content: center"
              onclick="openSheet()"
            >
              + Ø£Ø¶Ù Ù…Ù‡Ù…Ø©
            </button>
          </div>

          <!-- Work Tasks Section -->
          <div class="card" style="border-color: rgba(255, 101, 132, 0.25)">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 10px;
              "
            >
              <div class="sec-title" style="margin-bottom: 0">
                ğŸ’¼ Ù…Ù‡Ø§Ù… Ø§Ù„Ø´ØºÙ„
              </div>
              <div style="display: flex; gap: 6px">
                <button
                  class="btn btn-sm"
                  onclick="analyzeWorkTasks()"
                  id="analyzeBtn"
                  style="font-size: 11px; padding: 5px 10px"
                >
                  ğŸ¤– Ø­Ù„Ù„
                </button>
                <button
                  class="btn btn-sm"
                  onclick="openWorkSheet()"
                  style="font-size: 11px; padding: 5px 10px"
                >
                  + Ù…Ù‡Ù…Ø©
                </button>
              </div>
            </div>
            <div id="workTasksList"></div>
            <div
              id="workAnalysis"
              style="
                display: none;
                margin-top: 10px;
                padding: 10px;
                background: rgba(108, 99, 255, 0.08);
                border: 1px solid rgba(108, 99, 255, 0.2);
                border-radius: 10px;
                font-size: 12px;
                line-height: 1.7;
              "
            ></div>
          </div>

          <div class="card" style="border-color: rgba(108, 99, 255, 0.2)">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 8px;
              "
            >
              <div class="sec-title" style="margin-bottom: 0">
                ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´ØºÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
              </div>
              <button
                class="btn btn-sm"
                onclick="generateWorkReport()"
                id="reportWorkBtn"
                style="font-size: 11px; padding: 5px 10px"
              >
                ğŸ“‹ Ø§Ø¹Ù…Ù„
              </button>
            </div>
            <div
              id="workReportTxt"
              style="font-size: 12px; color: var(--muted); line-height: 1.75"
            >
              Ø§Ø¶ØºØ· Ù„ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
            </div>
            <button
              class="btn btn-sm"
              onclick="copyWorkReport()"
              id="copyReportBtn"
              style="
                display: none;
                width: 100%;
                margin-top: 8px;
                justify-content: center;
              "
            >
              ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
          </div>

          <div class="card" style="border-color: rgba(108, 99, 255, 0.2)">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 8px;
              "
            >
              <div class="sec-title" style="margin-bottom: 0">
                ğŸ¯ Ù…Ù‡Ù…Ø© AI Ù„Ù„ÙŠÙˆÙ…
              </div>
              <button class="btn btn-sm" onclick="suggestTask()">Ø§Ù‚ØªØ±Ø­</button>
            </div>
            <div
              id="taskSuggest"
              style="font-size: 13px; color: var(--muted); line-height: 1.75"
            >
              Ø§Ø¶ØºØ· "Ø§Ù‚ØªØ±Ø­" Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ AI ÙŠØ­Ø¯Ø¯ Ø£Ù‡Ù… Ù…Ù‡Ù…Ø© ØªØ¹Ù…Ù„Ù‡Ø§ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡
            </div>
          </div>
          <div class="card">
            <div class="sec-title">ğŸ˜Š Ù…Ø²Ø§Ø¬Ùƒ Ø¥ÙŠÙ‡ØŸ</div>
            <div class="mood-row">
              <div class="mood-btn" onclick="setMood('ğŸ˜´', this)">ğŸ˜´</div>
              <div class="mood-btn" onclick="setMood('ğŸ˜', this)">ğŸ˜</div>
              <div class="mood-btn" onclick="setMood('ğŸ™‚', this)">ğŸ™‚</div>
              <div class="mood-btn" onclick="setMood('ğŸ’ª', this)">ğŸ’ª</div>
              <div class="mood-btn" onclick="setMood('ğŸ”¥', this)">ğŸ”¥</div>
            </div>
          </div>
          <div class="card">
            <div class="sec-title">ğŸ“ Ø§ØªØ¹Ù„Ù…Øª Ø¥ÙŠÙ‡ØŸ</div>
            <textarea
              id="noteArea"
              placeholder="Ø§ÙƒØªØ¨ Ø£Ù‡Ù… Ø­Ø§Ø¬Ø© Ø§ØªØ¹Ù„Ù…ØªÙ‡Ø§ Ø£Ùˆ Ø¹Ù…Ù„ØªÙ‡Ø§..."
              style="resize: none; height: 90px"
              oninput="saveNote()"
            ></textarea>
            <button
              class="btn btn-primary"
              style="margin-top: 10px"
              onclick="saveDay()"
            >
              ğŸ’¾ Ø§Ø­ÙØ¸ ÙŠÙˆÙ…Ùƒ
            </button>
          </div>
          <div class="card" style="text-align: center">
            <div class="sec-title" style="justify-content: center">
              â±ï¸ Ù…Ø¤Ù‚Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©
            </div>
            <div class="timer-big" id="timerDisp">90:00</div>
            <div
              style="
                display: flex;
                gap: 8px;
                margin-top: 12px;
                justify-content: center;
              "
            >
              <select
                id="timerSel"
                style="width: auto; padding: 8px 10px; font-size: 13px"
                onchange="resetTimer()"
              >
                <option value="90">90 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="60">60 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="45">45 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="25">25 Pomodoro</option>
              </select>
              <button
                class="btn btn-icon"
                id="timerBtn"
                onclick="toggleTimer()"
              >
                â–¶
              </button>
              <button class="btn btn-icon" onclick="resetTimer()">â†º</button>
            </div>
          </div>
        </div>

        <!-- AI CHAT -->
        <div
          class="page"
          id="page-ai"
          style="
            padding: 0;
            display: flex;
            flex-direction: column;
            height: calc(100dvh - 56px - 64px);
          "
        >
          <div
            id="chatMsgs"
            style="
              flex: 1;
              overflow-y: auto;
              -webkit-overflow-scrolling: touch;
              display: flex;
              flex-direction: column;
              gap: 10px;
              padding: 12px 12px 4px;
            "
          >
            <div style="display: flex; justify-content: flex-end">
              <div class="bubble ai">
                <strong style="color: var(--accent)"
                  >Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù†Ø§ÙØ³ AI ğŸ¤–</strong
                ><br />
                Ø¨Ø¹Ø±Ù Ø®Ø·ØªÙƒ ÙˆØ£Ø¯Ø§Ø¡Ùƒ. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø­Ø§Ø¬Ø© â€” ØªØ­Ù„ÙŠÙ„ØŒ Ù†ØµÙŠØ­Ø©ØŒ Ø£Ùˆ ØªØ´Ø¬ÙŠØ¹! ğŸ’ª
              </div>
            </div>
          </div>
          <div class="chips" style="padding-top: 8px; flex-shrink: 0">
            <div class="chip" onclick="qp('Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¦ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¯Ù‡')">
              ğŸ“Š Ø­Ù„Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            </div>
            <div class="chip" onclick="qp('Ø¥ÙŠÙ‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø£Ù‡Ù… Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ØŸ')">
              ğŸ¯ Ù…Ù‡Ù…Ø© Ø§Ù„ÙŠÙˆÙ…
            </div>
            <div class="chip" onclick="qp('Ø±ØªØ¨Ù„ÙŠ Ù…Ù‡Ø§Ù… Ø§Ù„Ø´ØºÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©')">
              ï¿½ Ø±ØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù…
            </div>
            <div class="chip" onclick="qp('Ø®Ø§ÙŠÙ Ø£ÙÙ‚Ø¯ Ø§Ù„Ù€ streakØŒ Ø³Ø§Ø¹Ø¯Ù†ÙŠ')">
              ï¿½ streak ÙÙŠ Ø®Ø·Ø±
            </div>
            <div class="chip" onclick="qp('Ù‚ÙŠÙ‘Ù… ØªÙ‚Ø¯Ù…ÙŠ Ø¨ØµØ±Ø§Ø­Ø©')">
              ğŸ” Ù‚ÙŠÙ‘Ù… ØªÙ‚Ø¯Ù…ÙŠ
            </div>
            <div class="chip" onclick="qp('Ø§Ø¹Ù…Ù„ÙŠ Ø®Ø·Ø© Ù…Ø°Ø§ÙƒØ±Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¬Ø§ÙŠ')">
              ğŸ“… Ø®Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            </div>
            <div class="chip" onclick="qp('Ø¥ÙŠÙ‡ Ù†Ù‚Ø§Ø· Ø¶Ø¹ÙÙŠØŸ')">âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</div>
          </div>
          <div
            style="
              padding: 8px 12px 12px;
              display: flex;
              gap: 8px;
              border-top: 1px solid var(--border);
              flex-shrink: 0;
            "
          >
            <input
              type="text"
              id="chatIn"
              placeholder="Ø§Ø³Ø£Ù„ Ø£ÙŠ Ø­Ø§Ø¬Ø©..."
              style="flex: 1"
              onkeydown="
                if (event.key === 'Enter' && !event.shiftKey) {
                  event.preventDefault();
                  sendMsg();
                }
              "
            />
            <button
              class="btn btn-icon"
              onclick="sendMsg()"
              id="sendBtn"
              style="flex-shrink: 0; font-size: 18px"
            >
              â†‘
            </button>
          </div>
        </div>

        <!-- PROGRESS -->
        <div class="page" id="page-progress">
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              margin-bottom: 14px;
            "
          >
            <p
              style="
                font-weight: 900;
                font-size: 20px;
                font-family: &quot;Tajawal&quot;, sans-serif;
              "
            >
              ğŸ“ˆ Ø±Ø­Ù„ØªÙƒ
            </p>
            <button class="btn btn-sm" onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-num" style="color: var(--accent)" id="pTotal">
                0
              </div>
              <div class="stat-label">Ø£ÙŠØ§Ù… Ù…Ø³Ø¬Ù„Ø©</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--green)" id="pBest">
                0
              </div>
              <div class="stat-label">Ø£ÙØ¶Ù„ streak ğŸ”¥</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--gold)" id="pAvg">
                0%
              </div>
              <div class="stat-label">Ù…ØªÙˆØ³Ø· ÙŠÙˆÙ…ÙŠ</div>
            </div>
            <div class="stat-card">
              <div class="stat-num" style="color: var(--red)" id="pRemain2">
                90
              </div>
              <div class="stat-label">ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</div>
            </div>
          </div>
          <div class="card">
            <div class="sec-title">Ø§Ù„Ù€ 90 ÙŠÙˆÙ… ÙƒØ§Ù…Ù„Ø©</div>
            <div class="cal-grid" id="fullCal"></div>
          </div>
          <div class="card" style="border-color: rgba(108, 99, 255, 0.25)">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 10px;
              "
            >
              <div style="display: flex; align-items: center; gap: 8px">
                <span>ğŸ“Š</span
                ><span style="font-weight: 700; font-size: 13px"
                  >ØªÙ‚Ø±ÙŠØ± AI Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span
                >
              </div>
              <button
                class="btn btn-sm"
                onclick="weeklyReport()"
                id="reportBtn"
              >
                Ø§Ø¹Ù…Ù„ ØªÙ‚Ø±ÙŠØ±
              </button>
            </div>
            <div
              id="reportTxt"
              style="font-size: 13px; color: var(--muted); line-height: 1.75"
            >
              Ø§Ø¶ØºØ· Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ AI ÙŠØ¹Ù…Ù„Ùƒ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
            </div>
          </div>
          <div class="card">
            <div class="sec-title">ğŸ““ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
            <div id="journal"></div>
          </div>
          <div class="card">
            <div class="sec-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            <div style="margin-bottom: 10px">
              <label
                style="
                  font-size: 12px;
                  color: var(--muted);
                  display: block;
                  margin-bottom: 6px;
                "
                >ğŸ”‘ API Key</label
              >
              <input type="password" id="newApiKey" placeholder="sk-ant-..." />
              <button
                class="btn btn-sm"
                style="margin-top: 8px; width: 100%; justify-content: center"
                onclick="saveApiKey()"
              >
                Ø­ÙØ¸ Ø§Ù„Ù€ Key
              </button>
            </div>
            <button
              class="btn btn-sm"
              style="
                width: 100%;
                justify-content: center;
                color: var(--red);
                border-color: rgba(255, 101, 132, 0.3);
              "
              onclick="resetApp()"
            >
              ğŸ—‘ï¸ Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯
            </button>
          </div>
        </div>
      </div>
      <!-- /content -->

      <div id="navbar">
        <button class="nav-item active" onclick="goPage('home')" id="nav-home">
          <span class="icon">ğŸ </span><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
        <button class="nav-item" onclick="goPage('today')" id="nav-today">
          <span class="icon">â˜€ï¸</span><span>Ø§Ù„ÙŠÙˆÙ…</span>
        </button>
        <button class="nav-item" onclick="goPage('ai')" id="nav-ai">
          <span class="icon">ğŸ¤–</span><span>AI</span>
        </button>
        <button class="nav-item" onclick="goPage('progress')" id="nav-progress">
          <span class="icon">ğŸ“ˆ</span><span>Ø§Ù„ØªÙ‚Ø¯Ù…</span>
        </button>
      </div>
    </div>

    <!-- Habit Sheet -->
    <div
      id="habitSheet"
      style="display: none; position: fixed; inset: 0; z-index: 150"
    >
      <div
        style="
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(4px);
        "
        onclick="closeSheet()"
      ></div>
      <div
        style="
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: var(--surface);
          border-radius: 20px 20px 0 0;
          padding: 20px;
          padding-bottom: calc(20px + env(safe-area-inset-bottom));
        "
      >
        <div
          style="
            width: 36px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 0 auto 16px;
          "
        ></div>
        <div class="sec-title">+ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
        <div style="margin-bottom: 10px">
          <input type="text" id="hName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©" />
        </div>
        <div
          style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px"
        >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ“š</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ’»</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ‹ï¸</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ“–</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ¯</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >âš¡</span
          >
          <span
            style="
              font-size: 22px;
              cursor: pointer;
              padding: 6px;
              border-radius: 8px;
            "
            onclick="pEmoji(this)"
            >ğŸ”¥</span
          >
        </div>
        <div style="margin-bottom: 14px">
          <input type="text" id="hEmoji" placeholder="Ø£Ùˆ Ø§ÙƒØªØ¨ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ" />
        </div>
        <button class="btn btn-primary" onclick="addHabit()">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>

    <!-- Work Task Sheet -->
    <div
      id="workSheet"
      style="display: none; position: fixed; inset: 0; z-index: 150"
    >
      <div
        style="
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(4px);
        "
        onclick="closeWorkSheet()"
      ></div>
      <div
        style="
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: var(--surface);
          border-radius: 20px 20px 0 0;
          padding: 20px;
          padding-bottom: calc(20px + env(safe-area-inset-bottom));
          max-height: 80vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            width: 36px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 0 auto 16px;
          "
        ></div>
        <div class="sec-title">ğŸ’¼ Ù…Ù‡Ù…Ø© Ø´ØºÙ„ Ø¬Ø¯ÙŠØ¯Ø©</div>
        <div style="margin-bottom: 10px">
          <input type="text" id="wTaskName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©" />
        </div>
        <div style="margin-bottom: 10px">
          <label
            style="
              font-size: 12px;
              color: var(--muted);
              display: block;
              margin-bottom: 6px;
            "
            >Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label
          >
          <div style="display: flex; gap: 8px">
            <button
              class="btn btn-sm priority-btn"
              onclick="selectPriority('high', this)"
              data-priority="high"
              style="flex: 1; border-color: var(--red); color: var(--red)"
            >
              ğŸ”´ Ø¹Ø§Ù„ÙŠØ©
            </button>
            <button
              class="btn btn-sm priority-btn active"
              onclick="selectPriority('medium', this)"
              data-priority="medium"
              style="
                flex: 1;
                border-color: var(--gold);
                color: var(--gold);
                background: rgba(245, 200, 66, 0.1);
              "
            >
              ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø©
            </button>
            <button
              class="btn btn-sm priority-btn"
              onclick="selectPriority('low', this)"
              data-priority="low"
              style="flex: 1; border-color: var(--green); color: var(--green)"
            >
              ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø©
            </button>
          </div>
        </div>
        <div style="margin-bottom: 10px">
          <label
            style="
              font-size: 12px;
              color: var(--muted);
              display: block;
              margin-bottom: 6px;
            "
            >Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø¯Ù‚ÙŠÙ‚Ø©)</label
          >
          <input
            type="number"
            id="wTaskTime"
            placeholder="30"
            value="30"
            min="5"
            max="480"
          />
        </div>
        <div style="margin-bottom: 14px">
          <label
            style="
              font-size: 12px;
              color: var(--muted);
              display: block;
              margin-bottom: 6px;
            "
            >Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label
          >
          <textarea
            id="wTaskNotes"
            placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."
            style="resize: none; height: 60px"
          ></textarea>
        </div>
        <button class="btn btn-primary" onclick="addWorkTask()">
          Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©
        </button>
      </div>
    </div>

    <div id="toast">âœ… ØªÙ…</div>

    <script>
      let S = {
        user: null,
        startDate: null,
        habits: [],
        days: {},
        apiKey: "",
        workTasks: [],
      };
      let timerSec = 90 * 60,
        timerOn = false,
        timerIv = null,
        selEmoji = "ğŸ“š",
        chatHist = [],
        activeTaskTimer = null,
        taskTimers = {};

      function init() {
        const d = localStorage.getItem("nafis_v3");
        if (d) {
          S = JSON.parse(d);
          if (!S.workTasks) S.workTasks = [];
          launch();
        } else {
          document.getElementById("sDate").value = tKey();
          document.getElementById("setup").style.display = "flex";
        }
      }

      function save() {
        localStorage.setItem("nafis_v3", JSON.stringify(S));
      }

      function startJourney() {
        const n = document.getElementById("sName").value.trim();
        const g = document.getElementById("sGoal").value.trim();
        const d = document.getElementById("sDate").value;
        const k = document.getElementById("sApiKey").value.trim();
        if (!n || !g || !d) {
          toast("âš ï¸ Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
          return;
        }
        S = {
          user: { name: n, goal: g },
          startDate: d,
          apiKey: k,
          habits: [
            { id: 1, name: "Ù…Ø°Ø§ÙƒØ±Ø© WordPress", emoji: "ğŸ“š", active: true },
            { id: 2, name: "ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠ", emoji: "ğŸ’»", active: true },
            { id: 3, name: "Ø§Ù„Ø¬ÙŠÙ…", emoji: "ğŸ‹ï¸", active: true },
            { id: 4, name: "Ù‚Ø±Ø§Ø¡Ø© Documentation", emoji: "ğŸ“–", active: true },
          ],
          days: {},
        };
        save();
        document.getElementById("setup").style.display = "none";
        launch();
      }

      function launch() {
        document.getElementById("app").style.display = "flex";
        document.getElementById("setup").style.display = "none";
        updateAll();
      }

      function tKey() {
        return new Date().toISOString().split("T")[0];
      }

      function dayN() {
        if (!S.startDate) return 1;
        const s = new Date(S.startDate);
        s.setHours(0, 0, 0, 0);
        const t = new Date();
        t.setHours(0, 0, 0, 0);
        return Math.max(1, Math.floor((t - s) / 86400000) + 1);
      }

      function getDd(k) {
        if (!S.days[k]) S.days[k] = { habits: {}, note: "", mood: "" };
        return S.days[k];
      }

      function todayPct() {
        const d = getDd(tKey());
        const total = S.habits.filter((h) => h.active).length;
        if (!total) return 0;
        return Math.round(
          (Object.values(d.habits).filter(Boolean).length / total) * 100,
        );
      }

      function streak() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        let s = 0;
        for (let i = 0; i < 90; i++) {
          const d = new Date(today);
          d.setDate(d.getDate() - i);
          const k = d.toISOString().split("T")[0];
          const data = S.days[k];
          if (data) {
            const total = S.habits.filter((h) => h.active).length;
            const done = Object.values(data.habits).filter(Boolean).length;
            if (total > 0 && done / total >= 0.5) s++;
            else if (i > 0) break;
          } else if (i > 0) break;
        }
        return s;
      }

      function bestStreak() {
        let best = 0,
          cur = 0;
        const start = new Date(S.startDate || new Date());
        for (let i = 0; i < 90; i++) {
          const d = new Date(start);
          d.setDate(d.getDate() + i);
          const data = S.days[d.toISOString().split("T")[0]];
          if (data) {
            const total = S.habits.filter((h) => h.active).length;
            const done = Object.values(data.habits).filter(Boolean).length;
            if (total > 0 && done / total >= 0.5) {
              cur++;
              best = Math.max(best, cur);
            } else cur = 0;
          } else cur = 0;
        }
        return best;
      }

      function avgPct() {
        const all = Object.values(S.days).map((d) => {
          const t = S.habits.filter((h) => h.active).length;
          const dn = Object.values(d.habits).filter(Boolean).length;
          return t > 0 ? (dn / t) * 100 : 0;
        });
        return all.length
          ? Math.round(all.reduce((a, b) => a + b, 0) / all.length)
          : 0;
      }

      function goPage(p) {
        document
          .querySelectorAll(".page")
          .forEach((x) => x.classList.remove("active"));
        document
          .querySelectorAll(".nav-item")
          .forEach((x) => x.classList.remove("active"));
        document.getElementById("page-" + p).classList.add("active");
        document.getElementById("nav-" + p).classList.add("active");
        document.getElementById("content").scrollTop = 0;
        if (p === "home") updateHome();
        if (p === "today") renderToday();
        if (p === "progress") renderProgress();
      }

      function updateAll() {
        updateHome();
        renderToday();
      }

      function updateHome() {
        const dn = Math.min(dayN(), 90);
        const str = streak();
        const pct = todayPct();
        document.getElementById("hStreak").textContent = str;
        document.getElementById("hName").textContent = S.user?.name || "";
        document.getElementById("greet").textContent =
          new Date().getHours() < 12
            ? "ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ğŸ‘‹"
            : new Date().getHours() < 17
              ? "ÙŠØ³Ø¹Ø¯ Ù…Ø³Ø§Ùƒ ğŸ‘‹"
              : "Ø¥Ø²ÙŠÙƒ ÙŠØ§ Ø¨Ø·Ù„ ğŸ‘‹";
        document.getElementById("welcomeMsg").textContent =
          "Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ " + (S.user?.name || "Ø¨Ø·Ù„");
        document.getElementById("dayNum").textContent = dn;
        document.getElementById("sStreak").textContent = str;
        const totalDone = Object.values(S.days).filter((d) => {
          const t = S.habits.filter((h) => h.active).length;
          const dn2 = Object.values(d.habits).filter(Boolean).length;
          return t > 0 && dn2 / t >= 0.5;
        }).length;
        document.getElementById("sDone").textContent = totalDone;
        const elapsed = Math.min(dayN(), 90);
        document.getElementById("sPct").textContent =
          elapsed > 0 ? Math.round((totalDone / elapsed) * 100) + "%" : "0%";
        document.getElementById("sRemain").textContent = Math.max(
          0,
          90 - dayN() + 1,
        );
        const circ = 2 * Math.PI * 32;
        document.getElementById("todayRing").style.strokeDashoffset =
          circ - (pct / 100) * circ;
        document.getElementById("todayPct").textContent = pct + "%";
        const phase = dn <= 30 ? 1 : dn <= 60 ? 2 : 3;
        const pVal =
          phase === 1
            ? Math.min(Math.max(dn - 1, 0), 30)
            : phase === 2
              ? Math.min(Math.max(dn - 30, 0), 30)
              : Math.min(Math.max(dn - 60, 0), 30);
        const pN = {
          1: ["Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 â€” Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª", "PHP + WordPress Core + Hooks"],
          2: ["Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 â€” Ø§Ù„ØªØ·ÙˆÙŠØ±", "WooCommerce + REST API + Performance"],
          3: ["Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 â€” Ø§Ù„Ø§Ø­ØªØ±Ø§Ù", "Portfolio + Freelance + SEO"],
        };
        document.getElementById("phName").textContent = pN[phase][0];
        document.getElementById("phDesc").textContent = pN[phase][1];
        document.getElementById("phBar").style.width = (pVal / 30) * 100 + "%";
        document.getElementById("phProg").textContent = pVal + " / 30 ÙŠÙˆÙ…";
        renderCal("calGrid");
      }

      function renderCal(id) {
        const el = document.getElementById(id);
        if (!el) return;
        const start = new Date(S.startDate || new Date());
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        let html = "";
        for (let i = 1; i <= 90; i++) {
          const d = new Date(start);
          d.setDate(d.getDate() + i - 1);
          d.setHours(0, 0, 0, 0);
          const k = d.toISOString().split("T")[0];
          const data = S.days[k];
          const isToday = d.getTime() === today.getTime();
          const isFuture = d > today;
          let cls = "cal-cell";
          if (isToday) cls += " today";
          else if (isFuture) cls += " future";
          else if (data) {
            const t = S.habits.filter((h) => h.active).length;
            const dn2 = Object.values(data.habits).filter(Boolean).length;
            const r = t > 0 ? dn2 / t : 0;
            if (r >= 0.8) cls += " done";
            else if (r > 0) cls += " partial";
          }
          html += `<div class="${cls}">${i}</div>`;
        }
        el.innerHTML = html;
      }

      function renderToday() {
        const k = tKey();
        const data = getDd(k);
        const dn = dayN();
        const now = new Date();
        const days = [
          "Ø§Ù„Ø£Ø­Ø¯",
          "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
          "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
          "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",
          "Ø§Ù„Ø®Ù…ÙŠØ³",
          "Ø§Ù„Ø¬Ù…Ø¹Ø©",
          "Ø§Ù„Ø³Ø¨Øª",
        ];
        const months = [
          "ÙŠÙ†Ø§ÙŠØ±",
          "ÙØ¨Ø±Ø§ÙŠØ±",
          "Ù…Ø§Ø±Ø³",
          "Ø£Ø¨Ø±ÙŠÙ„",
          "Ù…Ø§ÙŠÙˆ",
          "ÙŠÙˆÙ†ÙŠÙˆ",
          "ÙŠÙˆÙ„ÙŠÙˆ",
          "Ø£ØºØ³Ø·Ø³",
          "Ø³Ø¨ØªÙ…Ø¨Ø±",
          "Ø£ÙƒØªÙˆØ¨Ø±",
          "Ù†ÙˆÙÙ…Ø¨Ø±",
          "Ø¯ÙŠØ³Ù…Ø¨Ø±",
        ];
        document.getElementById("todayDateTxt").textContent =
          `${days[now.getDay()]}ØŒ ${now.getDate()} ${months[now.getMonth()]}`;
        document.getElementById("todayDayBadge").textContent =
          `ÙŠÙˆÙ… ${Math.min(dn, 90)}`;
        const active = S.habits.filter((h) => h.active);
        const doneCount = active.filter((h) => data.habits[h.id]).length;
        document.getElementById("habCount").textContent =
          `${doneCount}/${active.length}`;
        document.getElementById("habList").innerHTML = active
          .map(
            (h) => `
    <div class="habit-row ${data.habits[h.id] ? "done" : ""}" onclick="toggleH(${h.id})">
      <div class="habit-check">${data.habits[h.id] ? "âœ“" : ""}</div>
      <span style="font-size:20px;">${h.emoji}</span>
      <span style="font-weight:600;flex:1;">${h.name}</span>
      <span onclick="event.stopPropagation();removeH(${h.id})" style="color:var(--muted);font-size:20px;padding:4px;cursor:pointer;">Ã—</span>
    </div>`,
          )
          .join("");
        document.getElementById("noteArea").value = data.note || "";
        document
          .querySelectorAll(".mood-btn")
          .forEach((b) =>
            b.classList.toggle("selected", b.textContent.trim() === data.mood),
          );
        renderWorkTasks();
      }

      function toggleH(id) {
        const k = tKey();
        const data = getDd(k);
        data.habits[id] = !data.habits[id];
        save();
        renderToday();
        updateHome();
        toast(data.habits[id] ? "âœ… Ø£Ø­Ø³Ù†Øª!" : "â†© ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡");
      }
      function setMood(m, el) {
        getDd(tKey()).mood = m;
        save();
        document
          .querySelectorAll(".mood-btn")
          .forEach((b) => b.classList.remove("selected"));
        el.classList.add("selected");
      }
      function saveNote() {
        getDd(tKey()).note = document.getElementById("noteArea").value;
        save();
      }
      function saveDay() {
        saveNote();
        save();
        updateHome();
        toast("ğŸ’¾ ØªÙ… Ø­ÙØ¸ ÙŠÙˆÙ…Ùƒ!");
      }

      function openSheet() {
        document.getElementById("habitSheet").style.display = "block";
      }
      function closeSheet() {
        document.getElementById("habitSheet").style.display = "none";
      }
      function pEmoji(el) {
        selEmoji = el.textContent.trim();
        document.getElementById("hEmoji").value = selEmoji;
        document
          .querySelectorAll("#habitSheet span[onclick]")
          .forEach((e) => (e.style.background = "transparent"));
        el.style.background = "rgba(108,99,255,0.2)";
      }
      function addHabit() {
        const name = document.getElementById("hName").value.trim();
        const emoji =
          document.getElementById("hEmoji").value.trim() || selEmoji;
        if (!name) {
          toast("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©");
          return;
        }
        S.habits.push({ id: Date.now(), name, emoji, active: true });
        save();
        closeSheet();
        renderToday();
        document.getElementById("hName").value = "";
        toast("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
      }
      function removeH(id) {
        S.habits = S.habits.filter((h) => h.id !== id);
        save();
        renderToday();
      }

      // ==================== WORK TASKS ====================
      let selectedPriority = "medium",
        workReportCache = "";

      function openWorkSheet() {
        document.getElementById("workSheet").style.display = "block";
        selectedPriority = "medium";
      }
      function closeWorkSheet() {
        document.getElementById("workSheet").style.display = "none";
      }

      function selectPriority(p, el) {
        selectedPriority = p;
        document
          .querySelectorAll(".priority-btn")
          .forEach((b) => b.classList.remove("active"));
        el.classList.add("active");
      }

      function addWorkTask() {
        const name = document.getElementById("wTaskName").value.trim();
        const time = parseInt(document.getElementById("wTaskTime").value) || 30;
        const notes = document.getElementById("wTaskNotes").value.trim();
        if (!name) {
          toast("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©");
          return;
        }
        const k = tKey();
        if (!S.workTasks) S.workTasks = [];
        S.workTasks.push({
          id: Date.now(),
          name,
          priority: selectedPriority,
          estimatedTime: time,
          notes,
          done: false,
          actualTime: 0,
          date: k,
        });
        save();
        closeWorkSheet();
        renderToday();
        document.getElementById("wTaskName").value = "";
        document.getElementById("wTaskNotes").value = "";
        toast("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©");
      }

      function toggleWorkTask(id) {
        const task = S.workTasks.find((t) => t.id === id);
        if (!task) return;
        task.done = !task.done;
        if (task.done && activeTaskTimer === id) {
          stopTaskTimer(id);
        }
        save();
        renderToday();
        toast(task.done ? "âœ… Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø©!" : "â†© ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡");
      }

      function startTaskTimer(id) {
        if (activeTaskTimer) {
          stopTaskTimer(activeTaskTimer);
        }
        activeTaskTimer = id;
        if (!taskTimers[id]) taskTimers[id] = 0;
        const iv = setInterval(() => {
          taskTimers[id]++;
          const task = S.workTasks.find((t) => t.id === id);
          if (task) task.actualTime = taskTimers[id];
          save();
          renderToday();
        }, 1000);
        taskTimers[id + "_iv"] = iv;
        renderToday();
      }

      function stopTaskTimer(id) {
        if (taskTimers[id + "_iv"]) {
          clearInterval(taskTimers[id + "_iv"]);
          delete taskTimers[id + "_iv"];
        }
        if (activeTaskTimer === id) activeTaskTimer = null;
        renderToday();
      }

      function deleteWorkTask(id) {
        if (activeTaskTimer === id) stopTaskTimer(id);
        S.workTasks = S.workTasks.filter((t) => t.id !== id);
        save();
        renderToday();
        toast("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù");
      }

      function formatTime(sec) {
        const h = Math.floor(sec / 3600);
        const m = Math.floor((sec % 3600) / 60);
        const s = sec % 60;
        if (h > 0) return `${h}Ø³ ${m}Ø¯`;
        if (m > 0) return `${m}Ø¯ ${s}Ø«`;
        return `${s}Ø«`;
      }

      function renderWorkTasks() {
        if (!S.workTasks) S.workTasks = [];
        const k = tKey();
        const todayTasks = S.workTasks.filter((t) => t.date === k);
        const el = document.getElementById("workTasksList");
        if (!el) return;
        if (todayTasks.length === 0) {
          el.innerHTML =
            '<p style="color:var(--muted);text-align:center;padding:16px;font-size:12px;">Ù…ÙÙŠØ´ Ù…Ù‡Ø§Ù… Ø´ØºÙ„ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ ğŸ’¼</p>';
          return;
        }
        const sorted = [...todayTasks].sort((a, b) => {
          const pOrder = { high: 0, medium: 1, low: 2 };
          if (a.done !== b.done) return a.done ? 1 : -1;
          return pOrder[a.priority] - pOrder[b.priority];
        });
        el.innerHTML = sorted
          .map((t) => {
            const pEmoji = { high: "ğŸ”´", medium: "ğŸŸ¡", low: "ğŸŸ¢" }[t.priority];
            const isRunning = activeTaskTimer === t.id;
            return `
            <div class="work-task ${t.done ? "done" : ""} priority-${t.priority}">
              <div class="task-header">
                <div class="task-check" onclick="toggleWorkTask(${t.id})">${t.done ? "âœ“" : ""}</div>
                <div class="task-title">${t.name}</div>
                <div class="task-priority">${pEmoji}</div>
                <span onclick="deleteWorkTask(${t.id})" style="color:var(--muted);font-size:18px;padding:4px;cursor:pointer;">Ã—</span>
              </div>
              <div class="task-meta">
                <div class="task-time">â±ï¸ ${t.actualTime > 0 ? formatTime(t.actualTime) : t.estimatedTime + "Ø¯"}</div>
                ${!t.done ? `<div class="task-timer-btn ${isRunning ? "active" : ""}" onclick="${isRunning ? "stopTaskTimer" : "startTaskTimer"}(${t.id})">${isRunning ? "â¸ Ø¥ÙŠÙ‚Ø§Ù" : "â–¶ Ø§Ø¨Ø¯Ø£"}</div>` : ""}
                ${t.notes ? `<div style="flex:1;font-size:10px;opacity:0.7;">${t.notes.substring(0, 30)}${t.notes.length > 30 ? "..." : ""}</div>` : ""}
              </div>
            </div>
          `;
          })
          .join("");
      }

      async function analyzeWorkTasks() {
        const btn = document.getElementById("analyzeBtn");
        const el = document.getElementById("workAnalysis");
        if (
          !S.workTasks ||
          S.workTasks.filter((t) => t.date === tKey() && !t.done).length === 0
        ) {
          toast("âš ï¸ Ù…ÙÙŠØ´ Ù…Ù‡Ø§Ù… Ù„Ù„ØªØ­Ù„ÙŠÙ„");
          return;
        }
        btn.disabled = true;
        btn.textContent = "â³";
        el.style.display = "block";
        el.innerHTML =
          '<div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
        const tasks = S.workTasks
          .filter((t) => t.date === tKey() && !t.done)
          .map(
            (t) =>
              `${t.priority === "high" ? "ğŸ”´" : "ğŸŸ¡"} ${t.name} (${t.estimatedTime}Ø¯)`,
          )
          .join("\n");
        const r = await callAI(
          `Ù…Ù‡Ø§Ù… Ø§Ù„Ø´ØºÙ„ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡:\n${tasks}\n\nØ­Ù„Ù„Ù‡Ù… ÙˆØ±ØªØ¨Ù‡Ù… Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Øª. Ø§Ù‚ØªØ±Ø­ ØªØ±ØªÙŠØ¨ ØªÙ†ÙÙŠØ° Ø°ÙƒÙŠ. 3-4 Ø¬Ù…Ù„.`,
          buildCtx(),
        );
        el.textContent = r;
        btn.disabled = false;
        btn.textContent = "ğŸ¤– Ø­Ù„Ù„";
      }

      async function generateWorkReport() {
        const btn = document.getElementById("reportWorkBtn");
        const el = document.getElementById("workReportTxt");
        const copyBtn = document.getElementById("copyReportBtn");
        btn.disabled = true;
        btn.textContent = "â³";
        const k = tKey();
        const tasks = S.workTasks.filter((t) => t.date === k);
        if (tasks.length === 0) {
          toast("âš ï¸ Ù…ÙÙŠØ´ Ù…Ù‡Ø§Ù… Ù„Ù„ØªÙ‚Ø±ÙŠØ±");
          btn.disabled = false;
          btn.textContent = "ğŸ“‹ Ø§Ø¹Ù…Ù„";
          return;
        }
        const done = tasks.filter((t) => t.done);
        const pending = tasks.filter((t) => !t.done);
        const totalTime = done.reduce(
          (sum, t) => sum + (t.actualTime || t.estimatedTime * 60),
          0,
        );
        const tasksStr = `Ù…ÙƒØªÙ…Ù„ (${done.length}):\n${done.map((t) => `âœ… ${t.name}`).join("\n")}\n\nÙ…ØªØ¨Ù‚ÙŠ (${pending.length}):\n${pending.map((t) => `â³ ${t.name}`).join("\n")}`;
        const r = await callAI(
          `Ø§Ø¹Ù…Ù„ ØªÙ‚Ø±ÙŠØ± Ø´ØºÙ„ ÙŠÙˆÙ…ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„:\n\n${tasksStr}\n\nØ§Ù„ÙˆÙ‚Øª: ${formatTime(totalTime)}\n\nØ§Ù„ØªÙ‚Ø±ÙŠØ± ÙŠÙƒÙˆÙ†: Ø¹Ù…Ù„Øª Ø¥ÙŠÙ‡ + Ù‡Ø¹Ù…Ù„ Ø¥ÙŠÙ‡ + Ø£ÙŠ ØªØ­Ø¯ÙŠØ§Øª. Ù…Ø®ØªØµØ± ÙˆÙˆØ§Ø¶Ø­.`,
          buildCtx(),
        );
        workReportCache = r;
        el.textContent = r;
        copyBtn.style.display = "block";
        btn.disabled = false;
        btn.textContent = "ğŸ“‹ Ø§Ø¹Ù…Ù„";
      }

      function copyWorkReport() {
        if (!workReportCache) {
          toast("âš ï¸ Ù…ÙÙŠØ´ ØªÙ‚Ø±ÙŠØ±");
          return;
        }
        navigator.clipboard
          .writeText(workReportCache)
          .then(() => toast("ğŸ“‹ ØªÙ… Ø§Ù„Ù†Ø³Ø®!"))
          .catch(() => toast("âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®"));
      }

      function renderProgress() {
        document.getElementById("pTotal").textContent = Object.keys(
          S.days,
        ).length;
        document.getElementById("pBest").textContent = bestStreak();
        document.getElementById("pAvg").textContent = avgPct() + "%";
        document.getElementById("pRemain2").textContent = Math.max(
          0,
          90 - dayN() + 1,
        );
        renderCal("fullCal");
        const entries = Object.entries(S.days)
          .filter(([, d]) => d.note)
          .sort(([a], [b]) => b.localeCompare(a))
          .slice(0, 5);
        document.getElementById("journal").innerHTML = entries.length
          ? entries
              .map(([k, d]) => {
                const dn2 = S.startDate
                  ? Math.floor(
                      (new Date(k) - new Date(S.startDate)) / 86400000,
                    ) + 1
                  : "-";
                return `<div style="padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;"><span>${d.mood || "ğŸ“…"}</span><span style="font-weight:700;font-size:12px;color:var(--accent);">ÙŠÙˆÙ… ${dn2}</span><span style="font-size:11px;color:var(--muted);">${k}</span></div>
      <p style="font-size:13px;line-height:1.7;">${d.note}</p></div>`;
              })
              .join("")
          : '<p style="color:var(--muted);text-align:center;padding:16px;font-size:13px;">Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ù…Ù„Ø§Ø­Ø¸Ø§Øª âœï¸</p>';
      }

      function saveApiKey() {
        S.apiKey = document.getElementById("newApiKey").value.trim();
        save();
        toast("ğŸ”‘ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù€ API Key");
      }
      function resetApp() {
        if (!confirm("Ù‡ØªÙ…Ø³Ø­ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ! Ù…Ø¤ÙƒØ¯ØŸ")) return;
        localStorage.removeItem("nafis_v3");
        location.reload();
      }
      function exportData() {
        const a = Object.assign(document.createElement("a"), {
          href: URL.createObjectURL(
            new Blob([JSON.stringify(S, null, 2)], {
              type: "application/json",
            }),
          ),
          download: `nafis_${tKey()}.json`,
        });
        a.click();
        toast("ğŸ“¤ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±!");
      }

      function toggleTimer() {
        if (timerOn) {
          clearInterval(timerIv);
          timerOn = false;
          document.getElementById("timerBtn").textContent = "â–¶";
        } else {
          timerOn = true;
          document.getElementById("timerBtn").textContent = "â¸";
          timerIv = setInterval(() => {
            if (timerSec <= 0) {
              clearInterval(timerIv);
              timerOn = false;
              document.getElementById("timerBtn").textContent = "â–¶";
              toast("ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©! Ø¹Ø¸ÙŠÙ…");
              return;
            }
            timerSec--;
            updTimer();
          }, 1000);
        }
      }
      function resetTimer() {
        clearInterval(timerIv);
        timerOn = false;
        timerSec = parseInt(document.getElementById("timerSel").value) * 60;
        document.getElementById("timerBtn").textContent = "â–¶";
        updTimer();
      }
      function updTimer() {
        const m = Math.floor(timerSec / 60),
          s = timerSec % 60;
        document.getElementById("timerDisp").textContent =
          String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
      }

      function buildCtx() {
        const dn = Math.min(dayN(), 90);
        const str = streak();
        const phase = dn <= 30 ? 1 : dn <= 60 ? 2 : 3;
        const recentDays = [];
        const today = new Date();
        for (let i = 6; i >= 0; i--) {
          const d = new Date(today);
          d.setDate(d.getDate() - i);
          d.setHours(0, 0, 0, 0);
          const k = d.toISOString().split("T")[0];
          const data = S.days[k];
          if (data) {
            const total = S.habits.filter((h) => h.active).length;
            const done = Object.values(data.habits).filter(Boolean).length;
            recentDays.push({
              date: k,
              pct: total > 0 ? Math.round((done / total) * 100) : 0,
              mood: data.mood || "-",
              note: data.note?.substring(0, 50) || "",
            });
          }
        }
        const phN = {
          1: "Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª (PHP+WordPress+Hooks)",
          2: "Ø§Ù„ØªØ·ÙˆÙŠØ± (WooCommerce+REST API)",
          3: "Ø§Ù„Ø§Ø­ØªØ±Ø§Ù (Portfolio+Freelance)",
        };
        const k = tKey();
        const todayWork = S.workTasks
          ? S.workTasks.filter((t) => t.date === k)
          : [];
        const workStr =
          todayWork.length > 0
            ? `\n\n== Ù…Ù‡Ø§Ù… Ø§Ù„Ø´ØºÙ„ Ø§Ù„ÙŠÙˆÙ… ==\n${todayWork.map((t) => `${t.done ? "âœ…" : "â³"} ${t.name} [${t.priority === "high" ? "ğŸ”´ Ø¹Ø§Ù„ÙŠØ©" : t.priority === "medium" ? "ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø©" : "ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø©"}] (${t.estimatedTime}Ø¯)`).join("\n")}`
            : "";
        return `Ø£Ù†Øª "Ù†Ø§ÙØ³ AI" â€” Ù…Ø³Ø§Ø¹Ø¯ Ø´Ø®ØµÙŠ Ø°ÙƒÙŠ ÙˆÙ…Ø­ÙØ² ÙŠØªÙƒÙ„Ù… Ø¹Ø±Ø¨ÙŠ Ø¨Ø£Ø³Ù„ÙˆØ¨ ØµØ±ÙŠØ­ ÙˆÙ…Ø¨Ø§Ø´Ø±.

== Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==
Ø§Ù„Ø§Ø³Ù…: ${S.user?.name} | Ø§Ù„Ù‡Ø¯Ù: ${S.user?.goal}
Ø§Ù„ÙŠÙˆÙ…: ${dn}/90 | Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${phase} â€” ${phN[phase]}
Streak: ${str} ÙŠÙˆÙ… | Ù…ØªÙˆØ³Ø·: ${avgPct()}% | Ø§Ù„ÙŠÙˆÙ…: ${todayPct()}%

== Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù… ==
${recentDays.map((d) => `${d.date}: ${d.pct}% Ù…Ø²Ø§Ø¬:${d.mood}${d.note ? ' "' + d.note + '"' : ""}`).join("\n") || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}

== Ø§Ù„Ù…Ù‡Ø§Ù… ==
${S.habits
  .filter((h) => h.active)
  .map((h) => h.emoji + " " + h.name)
  .join(" | ")}${workStr}

Ù‚ÙˆØ§Ø¹Ø¯: Ø±Ø¯ Ø¹Ø±Ø¨ÙŠØŒ Ù…Ø¨Ø§Ø´Ø±ØŒ Ø¹Ù…Ù„ÙŠØŒ Ù…Ø­ÙØ². Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©. Ù„Ø§ ØªØ·ÙˆÙ„.`.trim();
      }

      async function callAI(msg, sys) {
        if (!S.apiKey)
          return "âš ï¸ Ù…Ø­ØªØ§Ø¬ API Key Ù…Ù† Anthropic â€” Ø±ÙˆØ­ ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø¯Ù… â† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­Ø·Ù‡ Ù‡Ù†Ø§Ùƒ.\n\nÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡: console.anthropic.com â† API Keys";
        const msgs = [...chatHist, { role: "user", content: msg }];
        try {
          // Use Vercel serverless function as proxy
          const apiUrl =
            window.location.hostname === "localhost" ||
            window.location.protocol === "file:"
              ? "http://localhost:3000/api/chat"
              : "/api/chat";

          const res = await fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              apiKey: S.apiKey,
              messages: msgs,
              system: sys || buildCtx(),
            }),
          });

          if (!res.ok) {
            const e = await res.json().catch(() => ({}));
            if (res.status === 401 || e.status === 401)
              return "âŒ Ø§Ù„Ù€ API Key ØºÙ„Ø·. ØªØ£ÙƒØ¯ Ù…Ù†Ù‡.";
            if (res.status === 429 || e.status === 429)
              return "â³ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù€ APIØŒ Ø§Ø³ØªÙ†Ù‰ Ø«ÙˆØ§Ù†ÙŠ ÙˆØ­Ø§ÙˆÙ„.";
            return `âŒ Ø®Ø·Ø£ ${res.status}: ${e.error || e.message || "Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ"}`;
          }

          const data = await res.json();
          return data.content?.[0]?.text || "Ù…ÙÙŠØ´ Ø±Ø¯.";
        } catch (e) {
          console.error("API Error:", e);
          return "âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
        }
      }

      async function sendMsg() {
        const input = document.getElementById("chatIn");
        const msg = input.value.trim();
        if (!msg) return;
        input.value = "";
        addBubble(msg, "user");
        chatHist.push({ role: "user", content: msg });
        document.getElementById("sendBtn").disabled = true;
        showTyping();
        const reply = await callAI(msg);
        hideTyping();
        addBubble(reply, "ai");
        chatHist.push({ role: "assistant", content: reply });
        if (chatHist.length > 20) chatHist = chatHist.slice(-20);
        document.getElementById("sendBtn").disabled = false;
      }

      function qp(msg) {
        document.getElementById("chatIn").value = msg;
        sendMsg();
      }

      function addBubble(txt, role) {
        const wrap = document.createElement("div");
        wrap.style.cssText = `display:flex;justify-content:${role === "user" ? "flex-start" : "flex-end"};`;
        wrap.innerHTML = `<div class="bubble ${role}" style="white-space:pre-wrap;">${txt}</div>`;
        const msgs = document.getElementById("chatMsgs");
        msgs.appendChild(wrap);
        msgs.scrollTop = msgs.scrollHeight;
      }

      function showTyping() {
        const msgs = document.getElementById("chatMsgs");
        const div = document.createElement("div");
        div.id = "typing";
        div.style.cssText = "display:flex;justify-content:flex-end;";
        div.innerHTML =
          '<div class="bubble ai"><div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>';
        msgs.appendChild(div);
        msgs.scrollTop = msgs.scrollHeight;
      }
      function hideTyping() {
        const el = document.getElementById("typing");
        if (el) el.remove();
      }

      async function genInsight() {
        const btn = document.getElementById("insightBtn");
        const txt = document.getElementById("insightTxt");
        btn.disabled = true;
        btn.textContent = "â³";
        txt.innerHTML =
          '<div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
        const r = await callAI(
          "Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¦ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø²: 1) Ø¥ÙŠÙ‡ Ø¨Ø¹Ù…Ù„Ù‡ ÙƒÙˆÙŠØ³ 2) Ø¥ÙŠÙ‡ Ø£Ø­Ø³Ù†Ù‡ 3) Ù†ØµÙŠØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„ÙŠÙˆÙ…. 3-4 Ø¬Ù…Ù„ Ø¨Ø³.",
          buildCtx(),
        );
        txt.textContent = r;
        btn.disabled = false;
        btn.textContent = "ØªØ­Ù„ÙŠÙ„";
      }

      async function suggestTask() {
        const el = document.getElementById("taskSuggest");
        el.textContent = "â³ Ø¨ÙÙƒØ±...";
        const dow = [
          "Ø§Ù„Ø£Ø­Ø¯",
          "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
          "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
          "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",
          "Ø§Ù„Ø®Ù…ÙŠØ³",
          "Ø§Ù„Ø¬Ù…Ø¹Ø©",
          "Ø§Ù„Ø³Ø¨Øª",
        ][new Date().getDay()];
        const r = await callAI(
          `ÙŠÙˆÙ… ${dow}. Ø§Ù‚ØªØ±Ø­ Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø© Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø­Ø³Ø¨ Ù…Ø±Ø­Ù„ØªÙŠ. Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© + Ø¬Ù…Ù„Ø© Ø´Ø±Ø­ + Ø§Ù„Ø³Ø¨Ø¨. Ù…Ø´ Ø£ÙƒØªØ± Ù…Ù† 3 Ø¬Ù…Ù„.`,
          buildCtx(),
        );
        el.textContent = r;
      }

      async function weeklyReport() {
        const btn = document.getElementById("reportBtn");
        const txt = document.getElementById("reportTxt");
        btn.disabled = true;
        btn.textContent = "â³";
        txt.innerHTML =
          '<div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
        const r = await callAI(
          "Ø§Ø¹Ù…Ù„ÙŠ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ: Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§ØªØŒ Ø§Ù„ØªØ­Ø¯ÙŠØ§ØªØŒ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¶Ø¹ÙØŒ ÙˆØªÙˆØµÙŠØ© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¬Ø§ÙŠ. ØµØ±ÙŠØ­ ÙˆØ¹Ù…Ù„ÙŠ.",
          buildCtx(),
        );
        txt.textContent = r;
        btn.disabled = false;
        btn.textContent = "Ø§Ø¹Ù…Ù„ ØªÙ‚Ø±ÙŠØ±";
      }

      function toast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.style.transform = "translateX(-50%) translateY(0)";
        setTimeout(() => {
          t.style.transform = "translateX(-50%) translateY(80px)";
        }, 2500);
      }

      init();
    </script>
  </body>
</html>
