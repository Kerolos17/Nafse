<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø§ÙØ³ | Ø®Ø·ØªÙƒ ÙÙŠ 90 ÙŠÙˆÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: {
        cairo: ['Cairo', 'sans-serif'],
        tajawal: ['Tajawal', 'sans-serif'],
      }
    }
  }
}
</script>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a25;
    --border: #2a2a3a;
    --accent: #6c63ff;
    --accent2: #ff6584;
    --gold: #f5c842;
    --green: #36d399;
    --text: #e8e8f0;
    --muted: #6b6b85;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Cairo', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grain texture */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.4;
  }

  /* Glow orbs */
  .orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
    z-index: 0;
    opacity: 0.12;
  }

  .nav-tab {
    cursor: pointer;
    padding: 10px 20px;
    border-radius: 12px;
    transition: all 0.3s;
    font-weight: 600;
    font-size: 14px;
    color: var(--muted);
    border: 1px solid transparent;
  }
  .nav-tab.active {
    background: var(--surface2);
    color: var(--text);
    border-color: var(--border);
  }
  .nav-tab:hover:not(.active) { color: var(--text); }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .card:hover { border-color: #3a3a55; }

  .card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(108,99,255,0.03) 0%, transparent 60%);
    pointer-events: none;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), #8b5cf6);
    color: white;
    border: none;
    border-radius: 14px;
    padding: 12px 28px;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(108,99,255,0.3);
  }
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(108,99,255,0.5);
  }

  .btn-ghost {
    background: transparent;
    color: var(--muted);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 20px;
    font-family: 'Cairo', sans-serif;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .btn-ghost:hover { color: var(--text); border-color: #3a3a55; }

  .progress-ring {
    transform: rotate(-90deg);
  }
  .progress-ring-circle {
    transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    stroke-linecap: round;
  }

  .habit-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 18px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s;
    user-select: none;
  }
  .habit-item:hover { border-color: #3a3a55; }
  .habit-item.done {
    border-color: rgba(54,211,153,0.3);
    background: rgba(54,211,153,0.05);
  }

  .habit-check {
    width: 26px;
    height: 26px;
    border-radius: 8px;
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s;
    font-size: 14px;
  }
  .habit-item.done .habit-check {
    background: var(--green);
    border-color: var(--green);
  }

  .day-cell {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--surface2);
    color: var(--muted);
  }
  .day-cell.today {
    border-color: var(--accent);
    color: var(--accent);
  }
  .day-cell.done-day {
    background: rgba(54,211,153,0.15);
    border-color: rgba(54,211,153,0.4);
    color: var(--green);
  }
  .day-cell.partial {
    background: rgba(245,200,66,0.1);
    border-color: rgba(245,200,66,0.3);
    color: var(--gold);
  }

  .phase-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 14px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 700;
  }

  .streak-flame {
    animation: flame 1.5s ease-in-out infinite alternate;
  }
  @keyframes flame {
    from { transform: scale(1) rotate(-3deg); }
    to { transform: scale(1.1) rotate(3deg); }
  }

  .stat-num {
    font-family: 'Tajawal', sans-serif;
    font-weight: 900;
    font-size: 36px;
    line-height: 1;
  }

  input, textarea, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 12px;
    padding: 12px 16px;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    width: 100%;
    outline: none;
    transition: border-color 0.3s;
  }
  input:focus, textarea:focus, select:focus {
    border-color: var(--accent);
  }
  input::placeholder { color: var(--muted); }

  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 32px;
    width: 100%;
    max-width: 480px;
    position: relative;
  }

  .page { display: none; }
  .page.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .page.active { animation: fadeIn 0.4s ease; }

  .quote-card {
    background: linear-gradient(135deg, rgba(108,99,255,0.1), rgba(139,92,246,0.05));
    border: 1px solid rgba(108,99,255,0.2);
    border-radius: 16px;
    padding: 20px 24px;
  }

  .level-bar {
    height: 6px;
    background: var(--surface2);
    border-radius: 100px;
    overflow: hidden;
  }
  .level-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), #8b5cf6);
    border-radius: 100px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
  }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .toggle-btn {
    display: flex;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 4px;
    gap: 4px;
  }
  .toggle-option {
    padding: 8px 16px;
    border-radius: 9px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    transition: all 0.2s;
  }
  .toggle-option.active {
    background: var(--surface);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
</style>
</head>
<body>

<!-- Glow orbs -->
<div class="orb" style="width:500px;height:500px;background:var(--accent);top:-200px;right:-100px;"></div>
<div class="orb" style="width:400px;height:400px;background:var(--accent2);bottom:-150px;left:-100px;"></div>

<!-- Setup Screen -->
<div id="setupScreen" class="min-h-screen flex items-center justify-center p-6" style="position:relative;z-index:1;">
  <div class="w-full max-w-lg">
    <div class="text-center mb-10">
      <div style="font-size:48px;margin-bottom:16px;">ğŸ¯</div>
      <h1 class="text-4xl font-black mb-3" style="font-family:'Tajawal',sans-serif;">Ù†Ø§ÙØ³</h1>
      <p class="text-lg" style="color:var(--muted);">Ø®Ø·ØªÙƒ ÙÙŠ 90 ÙŠÙˆÙ… â€” ØªØ¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§</p>
    </div>

    <div class="card mb-6">
      <h2 class="text-xl font-bold mb-6">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ğŸš€</h2>
      
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2" style="color:var(--muted);">Ø§Ø³Ù…Ùƒ</label>
        <input type="text" id="setupName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø£Ø­Ù…Ø¯" />
      </div>

      <div class="mb-4">
        <label class="block text-sm font-semibold mb-2" style="color:var(--muted);">Ù‡Ø¯ÙÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙŠ 90 ÙŠÙˆÙ…</label>
        <input type="text" id="setupGoal" placeholder="Ù…Ø«Ù„Ø§Ù‹: WordPress Developer Ù…Ø­ØªØ±Ù" />
      </div>

      <div class="mb-6">
        <label class="block text-sm font-semibold mb-2" style="color:var(--muted);">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
        <input type="date" id="setupDate" />
      </div>

      <button class="btn-primary w-full text-lg py-4" onclick="startJourney()">
        Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© 90 ÙŠÙˆÙ… ğŸ”¥
      </button>
    </div>

    <p class="text-center text-sm" style="color:var(--muted);">ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· ğŸ”’</p>
  </div>
</div>

<!-- Main App -->
<div id="mainApp" style="display:none;position:relative;z-index:1;">
  
  <!-- Header -->
  <header style="background:rgba(10,10,15,0.8);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50;">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span style="font-size:24px;">ğŸ¯</span>
        <span class="text-xl font-black" style="font-family:'Tajawal',sans-serif;">Ù†Ø§ÙØ³</span>
      </div>
      
      <nav class="flex items-center gap-2">
        <div class="nav-tab active" onclick="showPage('dashboard')" id="tab-dashboard">ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="nav-tab" onclick="showPage('today')" id="tab-today">â˜€ï¸ Ø§Ù„ÙŠÙˆÙ…</div>
        <div class="nav-tab" onclick="showPage('plan')" id="tab-plan">ğŸ“‹ Ø§Ù„Ø®Ø·Ø©</div>
        <div class="nav-tab" onclick="showPage('progress')" id="tab-progress">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø¯Ù…</div>
      </nav>

      <div class="flex items-center gap-3">
        <div class="streak-flame" style="font-size:20px;">ğŸ”¥</div>
        <span id="headerStreak" class="font-black" style="font-family:'Tajawal',sans-serif;color:var(--gold);font-size:18px;">0</span>
        <div style="width:1px;height:24px;background:var(--border);"></div>
        <span id="headerName" class="font-semibold text-sm" style="color:var(--muted);"></span>
      </div>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-6 py-8">

    <!-- DASHBOARD PAGE -->
    <div id="page-dashboard" class="page active">
      
      <!-- Welcome + Quote -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-2">
          <div>
            <p class="text-sm font-semibold" style="color:var(--muted);" id="greetingText">ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ğŸ‘‹</p>
            <h1 class="text-3xl font-black" style="font-family:'Tajawal',sans-serif;" id="dashWelcome">Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„</h1>
          </div>
          <div style="text-align:left;">
            <p class="text-sm" style="color:var(--muted);">Ø§Ù„ÙŠÙˆÙ… Ø±Ù‚Ù…</p>
            <p class="text-4xl font-black" style="font-family:'Tajawal',sans-serif;color:var(--accent);" id="dayNumber">1</p>
            <p class="text-xs" style="color:var(--muted);">Ù…Ù† 90</p>
          </div>
        </div>
      </div>

      <!-- Stats Row -->
      <div class="grid grid-cols-4 gap-4 mb-8">
        <div class="card text-center">
          <div class="stat-num" style="color:var(--accent);" id="statStreak">0</div>
          <div class="text-sm mt-1" style="color:var(--muted);">ğŸ”¥ ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ</div>
        </div>
        <div class="card text-center">
          <div class="stat-num" style="color:var(--green);" id="statDone">0</div>
          <div class="text-sm mt-1" style="color:var(--muted);">âœ… Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
        <div class="card text-center">
          <div class="stat-num" style="color:var(--gold);" id="statPercent">0%</div>
          <div class="text-sm mt-1" style="color:var(--muted);">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
        </div>
        <div class="card text-center">
          <div class="stat-num" style="color:var(--accent2);" id="statRemain">90</div>
          <div class="text-sm mt-1" style="color:var(--muted);">ğŸ“… ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="grid grid-cols-3 gap-6">
        
        <!-- Progress Ring + Today Quick -->
        <div class="col-span-1">
          <div class="card mb-4 flex flex-col items-center">
            <p class="font-bold mb-4">ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…</p>
            <div style="position:relative;width:140px;height:140px;">
              <svg width="140" height="140" class="progress-ring">
                <circle cx="70" cy="70" r="56" fill="none" stroke="var(--surface2)" stroke-width="12"/>
                <circle id="todayRing" cx="70" cy="70" r="56" fill="none" stroke="var(--green)" stroke-width="12"
                  stroke-dasharray="352" stroke-dashoffset="352" class="progress-ring-circle"/>
              </svg>
              <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;">
                <span class="text-3xl font-black" style="font-family:'Tajawal',sans-serif;" id="todayPercent">0%</span>
                <span class="text-xs" style="color:var(--muted);">Ù…ÙƒØªÙ…Ù„</span>
              </div>
            </div>
            <button class="btn-primary mt-4 w-full text-sm py-3" onclick="showPage('today')">
              Ø³Ø¬Ù‘Ù„ ÙŠÙˆÙ…Ùƒ â˜€ï¸
            </button>
          </div>

          <!-- Phase indicator -->
          <div class="card">
            <p class="font-bold mb-3 text-sm">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ğŸ“š</p>
            <div id="currentPhase">
              <div class="phase-badge mb-2" style="background:rgba(108,99,255,0.1);color:var(--accent);">
                <span>ğŸŒ±</span> <span id="phaseName">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1</span>
              </div>
              <p class="text-xs" style="color:var(--muted);" id="phaseDesc">PHP + WordPress Core + Hooks</p>
              <div class="level-bar mt-3">
                <div class="level-fill" id="phaseBar" style="width:0%"></div>
              </div>
              <p class="text-xs mt-1" style="color:var(--muted);" id="phaseProgress">0 / 30 ÙŠÙˆÙ…</p>
            </div>
          </div>
        </div>

        <!-- This week calendar -->
        <div class="col-span-2">
          <div class="card mb-4">
            <div class="flex items-center justify-between mb-4">
              <p class="font-bold">90 ÙŠÙˆÙ… â€” Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</p>
              <div class="toggle-btn">
                <div class="toggle-option active" onclick="switchView('week')" id="viewWeek">Ø£Ø³Ø¨ÙˆØ¹</div>
                <div class="toggle-option" onclick="switchView('full')" id="viewFull">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</div>
              </div>
            </div>
            <div id="calendarGrid" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
          </div>

          <!-- Quote -->
          <div class="quote-card">
            <p class="text-xs font-semibold mb-2" style="color:var(--accent);">ğŸ’¡ ÙƒÙ„Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</p>
            <p class="font-semibold" id="dailyQuote" style="line-height:1.8;">Ø®Ù„ÙŠ Ù…Ø¬Ø§Ù„Ùƒ ÙŠØ¨Ù‚Ù‰ Ø£Ø¹Ù…Ù‚ Ø¨Ø¯Ù„ Ù…Ø§ ÙŠØ¨Ù‚Ù‰ Ø£ÙˆØ³Ø¹</p>
          </div>
        </div>

      </div>
    </div>

    <!-- TODAY PAGE -->
    <div id="page-today" class="page">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-3xl font-black" style="font-family:'Tajawal',sans-serif;">â˜€ï¸ ÙŠÙˆÙ… Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡</h1>
          <p class="text-sm mt-1" style="color:var(--muted);" id="todayDate">Ø§Ù„Ø¬Ù…Ø¹Ø©ØŒ 27 ÙØ¨Ø±Ø§ÙŠØ± 2026</p>
        </div>
        <div class="text-left">
          <p class="text-xs" style="color:var(--muted);">Ø§Ù„ÙŠÙˆÙ… Ø±Ù‚Ù…</p>
          <p class="text-4xl font-black" style="font-family:'Tajawal',sans-serif;color:var(--accent);" id="todayDayNum">-</p>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-6">
        <!-- Habits -->
        <div>
          <div class="card">
            <div class="flex items-center justify-between mb-5">
              <h2 class="font-bold text-lg">âœ… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
              <span class="text-sm font-bold" style="color:var(--green);" id="habitsCount">0/0</span>
            </div>
            <div id="habitsList" class="flex flex-col gap-3"></div>
            <button class="btn-ghost w-full mt-4 text-sm" onclick="openAddHabit()">+ Ø£Ø¶Ù Ù…Ù‡Ù…Ø©</button>
          </div>
        </div>

        <!-- Notes + Mood -->
        <div class="flex flex-col gap-4">
          <!-- Mood -->
          <div class="card">
            <h2 class="font-bold mb-4">ğŸ˜Š ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ØŸ</h2>
            <div class="flex gap-3 justify-center">
              <div class="mood-btn text-3xl cursor-pointer transition-all hover:scale-125 p-2 rounded-xl" onclick="setMood('ğŸ˜´', this)" style="font-size:28px;">ğŸ˜´</div>
              <div class="mood-btn text-3xl cursor-pointer transition-all hover:scale-125 p-2 rounded-xl" onclick="setMood('ğŸ˜', this)">ğŸ˜</div>
              <div class="mood-btn text-3xl cursor-pointer transition-all hover:scale-125 p-2 rounded-xl" onclick="setMood('ğŸ™‚', this)">ğŸ™‚</div>
              <div class="mood-btn text-3xl cursor-pointer transition-all hover:scale-125 p-2 rounded-xl" onclick="setMood('ğŸ’ª', this)">ğŸ’ª</div>
              <div class="mood-btn text-3xl cursor-pointer transition-all hover:scale-125 p-2 rounded-xl" onclick="setMood('ğŸ”¥', this)">ğŸ”¥</div>
            </div>
          </div>

          <!-- Study Note -->
          <div class="card flex-1">
            <h2 class="font-bold mb-4">ğŸ“ Ø§ØªØ¹Ù„Ù…Øª Ø¥ÙŠÙ‡ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ØŸ</h2>
            <textarea id="todayNote" placeholder="Ø§ÙƒØªØ¨ Ø£Ù‡Ù… Ø­Ø§Ø¬Ø© Ø§ØªØ¹Ù„Ù…ØªÙ‡Ø§ Ø£Ùˆ Ø¹Ù…Ù„ØªÙ‡Ø§..." 
              style="resize:none;min-height:100px;width:100%;" oninput="saveTodayNote()"></textarea>
            <button class="btn-primary w-full mt-3 text-sm py-3" onclick="saveDay()">
              ğŸ’¾ Ø§Ø­ÙØ¸ ÙŠÙˆÙ…Ùƒ
            </button>
          </div>

          <!-- Session timer -->
          <div class="card text-center">
            <h2 class="font-bold mb-3">â±ï¸ Ù…Ø¤Ù‚Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</h2>
            <div class="text-5xl font-black mb-4" style="font-family:'Tajawal',sans-serif;color:var(--accent);" id="timerDisplay">90:00</div>
            <div class="flex gap-2 justify-center">
              <select id="timerSelect" style="width:auto;padding:8px 12px;font-size:13px;" onchange="setTimer()">
                <option value="90">90 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="60">60 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="45">45 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                <option value="25">25 Ø¯Ù‚ÙŠÙ‚Ø© (Pomodoro)</option>
              </select>
              <button class="btn-primary py-2 px-4 text-sm" id="timerBtn" onclick="toggleTimer()">â–¶ Ø§Ø¨Ø¯Ø£</button>
              <button class="btn-ghost py-2 px-4 text-sm" onclick="resetTimer()">â†º</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PLAN PAGE -->
    <div id="page-plan" class="page">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-3xl font-black" style="font-family:'Tajawal',sans-serif;">ğŸ“‹ Ø§Ù„Ø®Ø·Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h1>
          <p class="text-sm mt-1" style="color:var(--muted);">90 ÙŠÙˆÙ… â€” 3 Ù…Ø±Ø§Ø­Ù„</p>
        </div>
      </div>

      <div class="grid grid-cols-3 gap-6 mb-8">
        <!-- Phase 1 -->
        <div class="card">
          <div class="phase-badge mb-3" style="background:rgba(108,99,255,0.1);color:var(--accent);">ğŸŒ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 â€” ÙŠÙˆÙ… 1-30</div>
          <h3 class="font-bold text-lg mb-3">Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª</h3>
          <div class="flex flex-col gap-2" id="phase1Topics">
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ“š</span> PHP Fundamentals
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ”§</span> WordPress Core
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ¨</span> Theme Hierarchy
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸª</span> Hooks & Filters
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ› ï¸</span> Custom Theme Ø¨Ø¥ÙŠØ¯Ùƒ
            </div>
          </div>
          <div class="level-bar mt-4">
            <div class="level-fill" id="phase1Bar" style="width:0%;"></div>
          </div>
          <p class="text-xs mt-2" style="color:var(--muted);" id="phase1Prog">0 / 30 ÙŠÙˆÙ…</p>
        </div>

        <!-- Phase 2 -->
        <div class="card">
          <div class="phase-badge mb-3" style="background:rgba(245,200,66,0.1);color:var(--gold);">âš¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 â€” ÙŠÙˆÙ… 31-60</div>
          <h3 class="font-bold text-lg mb-3">Ø§Ù„ØªØ·ÙˆÙŠØ±</h3>
          <div class="flex flex-col gap-2">
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ›’</span> WooCommerce Customization
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ“¦</span> Custom Post Types
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ”Œ</span> REST API
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>âš¡</span> Speed Optimization
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ”’</span> Security
            </div>
          </div>
          <div class="level-bar mt-4">
            <div class="level-fill" id="phase2Bar" style="width:0%;background:linear-gradient(90deg,var(--gold),#f59e0b);"></div>
          </div>
          <p class="text-xs mt-2" style="color:var(--muted);" id="phase2Prog">0 / 30 ÙŠÙˆÙ…</p>
        </div>

        <!-- Phase 3 -->
        <div class="card">
          <div class="phase-badge mb-3" style="background:rgba(54,211,153,0.1);color:var(--green);">ğŸ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 â€” ÙŠÙˆÙ… 61-90</div>
          <h3 class="font-bold text-lg mb-3">Ø§Ù„Ø§Ø­ØªØ±Ø§Ù</h3>
          <div class="flex flex-col gap-2">
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ’¼</span> Portfolio Project
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ“Š</span> Case Studies
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ¤</span> Ø¹Ø±Ø¶ Ø§Ù„Ø´ØºÙ„
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸ’°</span> Freelance / Job Ready
            </div>
            <div class="flex items-center gap-2 text-sm p-2 rounded-lg" style="background:var(--surface2);">
              <span>ğŸŒŸ</span> SEO Technical
            </div>
          </div>
          <div class="level-bar mt-4">
            <div class="level-fill" id="phase3Bar" style="width:0%;background:linear-gradient(90deg,var(--green),#10b981);"></div>
          </div>
          <p class="text-xs mt-2" style="color:var(--muted);" id="phase3Prog">0 / 30 ÙŠÙˆÙ…</p>
        </div>
      </div>

      <!-- Weekly Schedule -->
      <div class="card">
        <h2 class="font-bold text-xl mb-6">ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h2>
        <div class="grid grid-cols-7 gap-3">
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø³Ø¨Øª</div>
            <div style="background:rgba(54,211,153,0.1);border:1px solid rgba(54,211,153,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ‹ï¸</div>
              <div class="text-xs mt-1" style="color:var(--green);">Ø¬ÙŠÙ…</div>
              <div class="text-xs" style="color:var(--muted);">5:30-7Ù…</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ“š Ù…Ø°Ø§ÙƒØ±Ø©</div>
                <div class="text-xs" style="color:var(--muted);">8-9:30Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø£Ø­Ø¯</div>
            <div style="background:rgba(54,211,153,0.1);border:1px solid rgba(54,211,153,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ‹ï¸</div>
              <div class="text-xs mt-1" style="color:var(--green);">Ø¬ÙŠÙ…</div>
              <div class="text-xs" style="color:var(--muted);">5:30-7Ù…</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ“š Ù…Ø°Ø§ÙƒØ±Ø©</div>
                <div class="text-xs" style="color:var(--muted);">8-9:30Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div>
            <div style="background:rgba(108,99,255,0.1);border:1px solid rgba(108,99,255,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ”¥</div>
              <div class="text-xs mt-1" style="color:var(--accent);">ØªØ·ÙˆÙŠØ±</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ’» 3 Ø³Ø§Ø¹Ø§Øª</div>
                <div class="text-xs" style="color:var(--muted);">6-9Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div>
            <div style="background:rgba(54,211,153,0.1);border:1px solid rgba(54,211,153,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ‹ï¸</div>
              <div class="text-xs mt-1" style="color:var(--green);">Ø¬ÙŠÙ…</div>
              <div class="text-xs" style="color:var(--muted);">5:30-7Ù…</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ“š Ù…Ø°Ø§ÙƒØ±Ø©</div>
                <div class="text-xs" style="color:var(--muted);">8-9:30Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
            <div style="background:rgba(54,211,153,0.1);border:1px solid rgba(54,211,153,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ‹ï¸</div>
              <div class="text-xs mt-1" style="color:var(--green);">Ø¬ÙŠÙ…</div>
              <div class="text-xs" style="color:var(--muted);">5:30-7Ù…</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ“š Ù…Ø°Ø§ÙƒØ±Ø©</div>
                <div class="text-xs" style="color:var(--muted);">8-9:30Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--muted);">Ø§Ù„Ø®Ù…ÙŠØ³</div>
            <div style="background:rgba(108,99,255,0.1);border:1px solid rgba(108,99,255,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸ”¥</div>
              <div class="text-xs mt-1" style="color:var(--accent);">ØªØ·ÙˆÙŠØ±</div>
              <div style="margin-top:6px;padding:6px;background:rgba(108,99,255,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--accent);">ğŸ’» 3 Ø³Ø§Ø¹Ø§Øª</div>
                <div class="text-xs" style="color:var(--muted);">6-9Ù…</div>
              </div>
            </div>
          </div>
          <div class="text-center">
            <div class="font-bold text-sm mb-2" style="color:var(--gold);">Ø§Ù„Ø¬Ù…Ø¹Ø© â­</div>
            <div style="background:rgba(245,200,66,0.1);border:1px solid rgba(245,200,66,0.2);border-radius:12px;padding:12px 8px;">
              <div style="font-size:20px;">ğŸš€</div>
              <div class="text-xs mt-1" style="color:var(--gold);">Deep Work</div>
              <div style="margin-top:6px;padding:6px;background:rgba(245,200,66,0.1);border-radius:8px;">
                <div class="text-xs" style="color:var(--gold);">ğŸ’¡ Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù…Ù„</div>
                <div class="text-xs" style="color:var(--muted);">Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø±</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROGRESS PAGE -->
    <div id="page-progress" class="page">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-3xl font-black" style="font-family:'Tajawal',sans-serif;">ğŸ“ˆ Ø±Ø­Ù„ØªÙƒ</h1>
          <p class="text-sm mt-1" style="color:var(--muted);">ÙƒÙ„ ÙŠÙˆÙ… Ø¨ØªÙƒØªØ¨ ØªØ§Ø±ÙŠØ®Ùƒ</p>
        </div>
        <button class="btn-ghost text-sm" onclick="exportData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>

      <!-- Big Stats -->
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="card text-center" style="background:linear-gradient(135deg,rgba(108,99,255,0.1),transparent);">
          <div class="text-5xl font-black mb-1" style="font-family:'Tajawal',sans-serif;color:var(--accent);" id="progTotal">0</div>
          <div class="font-semibold" style="color:var(--muted);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
        </div>
        <div class="card text-center" style="background:linear-gradient(135deg,rgba(54,211,153,0.1),transparent);">
          <div class="text-5xl font-black mb-1" style="font-family:'Tajawal',sans-serif;color:var(--green);" id="progBest">0</div>
          <div class="font-semibold" style="color:var(--muted);">Ø£ÙØ¶Ù„ streak ğŸ”¥</div>
        </div>
        <div class="card text-center" style="background:linear-gradient(135deg,rgba(245,200,66,0.1),transparent);">
          <div class="text-5xl font-black mb-1" style="font-family:'Tajawal',sans-serif;color:var(--gold);" id="progAvg">0%</div>
          <div class="font-semibold" style="color:var(--muted);">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
        </div>
      </div>

      <!-- Calendar Full View -->
      <div class="card mb-6">
        <h2 class="font-bold text-lg mb-4">Ø§Ù„Ù€ 90 ÙŠÙˆÙ… Ø¨Ø§Ù„ØªÙØµÙŠÙ„</h2>
        <div id="fullCalendar" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
        <div class="flex items-center gap-6 mt-4">
          <div class="flex items-center gap-2"><div style="width:14px;height:14px;border-radius:4px;background:rgba(54,211,153,0.3);border:1px solid rgba(54,211,153,0.5);"></div><span class="text-xs" style="color:var(--muted);">Ù…ÙƒØªÙ…Ù„</span></div>
          <div class="flex items-center gap-2"><div style="width:14px;height:14px;border-radius:4px;background:rgba(245,200,66,0.2);border:1px solid rgba(245,200,66,0.4);"></div><span class="text-xs" style="color:var(--muted);">Ø¬Ø²Ø¦ÙŠ</span></div>
          <div class="flex items-center gap-2"><div style="width:14px;height:14px;border-radius:4px;background:var(--surface2);border:1px solid var(--border);"></div><span class="text-xs" style="color:var(--muted);">Ù„Ù… ÙŠÙØ³Ø¬ÙÙ‘Ù„</span></div>
        </div>
      </div>

      <!-- Journal -->
      <div class="card">
        <h2 class="font-bold text-lg mb-4">ğŸ““ Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
        <div id="journalList" class="flex flex-col gap-3"></div>
      </div>
    </div>

  </div>
</div>

<!-- Modals -->
<div id="addHabitModal" class="modal-overlay" style="display:none;">
  <div class="modal">
    <h2 class="font-bold text-xl mb-6">+ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
    <div class="mb-4">
      <label class="block text-sm font-semibold mb-2" style="color:var(--muted);">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©</label>
      <input type="text" id="newHabitName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø°Ø§ÙƒØ±Ø© WordPress" />
    </div>
    <div class="mb-4">
      <label class="block text-sm font-semibold mb-2" style="color:var(--muted);">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
      <div class="flex gap-2 flex-wrap">
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ“š</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ’»</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ‹ï¸</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ“–</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ¯</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">âš¡</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">ğŸ”¥</span>
        <span class="text-2xl cursor-pointer p-2 rounded-lg hover:bg-white/10 emoji-pick" onclick="pickEmoji(this)">âœï¸</span>
      </div>
      <input type="text" id="newHabitEmoji" placeholder="Ø£Ùˆ Ø§ÙƒØªØ¨ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù‡Ù†Ø§" style="margin-top:8px;" />
    </div>
    <div class="flex gap-3">
      <button class="btn-primary flex-1" onclick="addHabit()">Ø¥Ø¶Ø§ÙØ©</button>
      <button class="btn-ghost flex-1" onclick="closeModal('addHabitModal')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" style="position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 24px;font-weight:600;font-size:14px;z-index:200;transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 8px 32px rgba(0,0,0,0.4);">
  âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸
</div>

<script>
// ==================== STATE ====================
let state = {
  user: null,
  startDate: null,
  habits: [],
  days: {}, // { "2024-01-01": { habits: {id: true/false}, note: "", mood: "" } }
  settings: {}
};

const QUOTES = [
  "Ø®Ù„ÙŠ Ù…Ø¬Ø§Ù„Ùƒ ÙŠØ¨Ù‚Ù‰ Ø£Ø¹Ù…Ù‚ Ø¨Ø¯Ù„ Ù…Ø§ ÙŠØ¨Ù‚Ù‰ Ø£ÙˆØ³Ø¹",
  "90 ÙŠÙˆÙ…. Ù†ÙØ³ Ø§Ù„Ù†Ø¸Ø§Ù…. Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ§Øª.",
  "Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø¨ÙŠØ¬ÙŠ Ù…Ù† Ø§Ù„Ø«Ø¨Ø§Øª Ù…Ø´ Ù…Ù† Ø§Ù„ÙƒÙ…Ø§Ù„",
  "ÙƒÙ„ ÙŠÙˆÙ… Ø¨ØªØ¶ÙŠÙ Ù„Ø¨Ù†Ø© ÙÙŠ ØµØ±Ø­ Ø¶Ø®Ù…",
  "Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© ØªÙƒØ³Ø¨ Ø¯Ø§ÙŠÙ…Ø§Ù‹",
  "Ù…Ø´ Ù…Ø­ØªØ§Ø¬ ØªØªØ­ÙˆÙ„ Ù„Ø´Ø®Øµ Ù…Ø®ØªÙ„Ù. Ø¨Ø³ Ø§Ø¨Ø·Ù„ ØªØ¶ØºØ· Ù†ÙØ³Ùƒ",
  "Ø´ØºÙ„ ÙŠÙˆÙ…ÙŠ + ØªØ·ÙˆÙŠØ± Ù…Ø³Ø§Ø¦ÙŠ + Ø¬ÙŠÙ… Ù…Ù†ØªØ¸Ù… = ØªÙ‚Ø¯Ù… Ø«Ø§Ø¨Øª",
  "Ø§Ù„Ø¹Ù…Ù‚ Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªØ³Ø§Ø¹",
  "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø³ÙŠØ·Ø©: Ø§ÙØ¹Ù„ØŒ Ù„Ø§ ØªÙÙƒØ± ÙƒØªÙŠØ±",
  "ÙƒÙ„ ÙŠÙˆÙ… Ø¨ØªØµØ­Ù‰ ÙˆØ¨ØªÙƒÙ…Ù„ØŒ Ø¯Ù‡ Ù†Ø¬Ø§Ø­",
  "Ø§Ù„Ù€ Overthinking Ø¹Ø¯ÙˆÙƒ Ø§Ù„Ø£ÙˆÙ„",
  "Ø§Ø¹Ù…Ù„ Ø´ÙŠØ¡ ØµØºÙŠØ± ÙƒÙ„ ÙŠÙˆÙ… ÙˆØ§Ø¨Ù‚Ù‰ Ø«Ø§Ø¨Øª Ø¹Ù„ÙŠÙ‡"
];

let timerInterval = null;
let timerSeconds = 90 * 60;
let timerRunning = false;
let selectedEmoji = 'ğŸ“š';
let currentView = 'week';

// ==================== INIT ====================
function init() {
  const saved = localStorage.getItem('nafis_data');
  if (saved) {
    state = JSON.parse(saved);
    showApp();
  } else {
    // Set today as default date
    document.getElementById('setupDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('setupScreen').style.display = 'flex';
  }
}

function save() {
  localStorage.setItem('nafis_data', JSON.stringify(state));
}

function startJourney() {
  const name = document.getElementById('setupName').value.trim();
  const goal = document.getElementById('setupGoal').value.trim();
  const date = document.getElementById('setupDate').value;
  
  if (!name || !goal || !date) {
    showToast('âš ï¸ Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„');
    return;
  }

  state.user = { name, goal };
  state.startDate = date;
  state.habits = [
    { id: 1, name: 'Ù…Ø°Ø§ÙƒØ±Ø© WordPress', emoji: 'ğŸ“š', active: true },
    { id: 2, name: 'ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠ', emoji: 'ğŸ’»', active: true },
    { id: 3, name: 'Ø§Ù„Ø¬ÙŠÙ…', emoji: 'ğŸ‹ï¸', active: true },
    { id: 4, name: 'Ù‚Ø±Ø§Ø¡Ø© Documentation', emoji: 'ğŸ“–', active: true },
  ];
  state.days = {};

  save();
  document.getElementById('setupScreen').style.display = 'none';
  showApp();
}

function showApp() {
  document.getElementById('mainApp').style.display = 'block';
  document.getElementById('setupScreen').style.display = 'none';
  updateAll();
}

// ==================== NAVIGATION ====================
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('tab-' + page).classList.add('active');
  
  if (page === 'today') renderToday();
  if (page === 'progress') renderProgress();
  if (page === 'dashboard') updateDashboard();
}

// ==================== CORE FUNCTIONS ====================
function getDayNumber() {
  if (!state.startDate) return 1;
  const start = new Date(state.startDate);
  const today = new Date();
  start.setHours(0,0,0,0);
  today.setHours(0,0,0,0);
  return Math.max(1, Math.floor((today - start) / 86400000) + 1);
}

function getTodayKey() {
  return new Date().toISOString().split('T')[0];
}

function getDayData(key) {
  if (!state.days[key]) {
    state.days[key] = { habits: {}, note: '', mood: '' };
  }
  return state.days[key];
}

function getTodayCompletion() {
  const key = getTodayKey();
  const data = getDayData(key);
  const total = state.habits.filter(h => h.active).length;
  if (total === 0) return 0;
  const done = Object.values(data.habits).filter(Boolean).length;
  return Math.round((done / total) * 100);
}

function calculateStreak() {
  let streak = 0;
  const today = new Date();
  today.setHours(0,0,0,0);
  
  for (let i = 0; i < 90; i++) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const key = d.toISOString().split('T')[0];
    const data = state.days[key];
    if (data) {
      const total = state.habits.filter(h => h.active).length;
      const done = Object.values(data.habits).filter(Boolean).length;
      if (total > 0 && done / total >= 0.5) {
        streak++;
      } else if (i > 0) break;
    } else if (i > 0) break;
  }
  return streak;
}

function calculateBestStreak() {
  let best = 0, current = 0;
  const start = new Date(state.startDate || new Date());
  
  for (let i = 0; i < 90; i++) {
    const d = new Date(start);
    d.setDate(d.getDate() + i);
    const key = d.toISOString().split('T')[0];
    const data = state.days[key];
    if (data) {
      const total = state.habits.filter(h => h.active).length;
      const done = Object.values(data.habits).filter(Boolean).length;
      if (total > 0 && done / total >= 0.5) { current++; best = Math.max(best, current); }
      else current = 0;
    } else current = 0;
  }
  return best;
}

// ==================== UPDATE UI ====================
function updateAll() {
  updateHeader();
  updateDashboard();
  renderToday();
  updatePhases();
  setDailyQuote();
}

function updateHeader() {
  document.getElementById('headerName').textContent = state.user?.name || '';
  const streak = calculateStreak();
  document.getElementById('headerStreak').textContent = streak;
  document.getElementById('statStreak').textContent = streak;
}

function setDailyQuote() {
  const idx = getDayNumber() % QUOTES.length;
  document.getElementById('dailyQuote').textContent = QUOTES[idx];
}

function updateDashboard() {
  const dayNum = getDayNumber();
  const streak = calculateStreak();
  const todayPct = getTodayCompletion();
  
  // Header stuff
  document.getElementById('dayNumber').textContent = Math.min(dayNum, 90);
  document.getElementById('statStreak').textContent = streak;
  document.getElementById('headerStreak').textContent = streak;
  
  // Greeting
  const hour = new Date().getHours();
  let greeting = hour < 12 ? 'ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ğŸ‘‹' : hour < 17 ? 'ÙŠØ³Ø¹Ø¯ Ù…Ø³Ø§Ùƒ ğŸ‘‹' : 'Ø¥Ø²ÙŠÙƒ ÙŠØ§ Ø¨Ø·Ù„ ğŸ‘‹';
  document.getElementById('greetingText').textContent = greeting;
  document.getElementById('dashWelcome').textContent = `Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ ${state.user?.name || 'Ø¨Ø·Ù„'}`;

  // Completed days
  const totalDone = Object.values(state.days).filter(d => {
    const total = state.habits.filter(h => h.active).length;
    const done = Object.values(d.habits).filter(Boolean).length;
    return total > 0 && done / total >= 0.5;
  }).length;
  
  document.getElementById('statDone').textContent = totalDone;
  
  const elapsed = Math.min(dayNum, 90);
  const pct = elapsed > 0 ? Math.round((totalDone / elapsed) * 100) : 0;
  document.getElementById('statPercent').textContent = pct + '%';
  document.getElementById('statRemain').textContent = Math.max(0, 90 - dayNum + 1);

  // Today ring
  const circumference = 2 * Math.PI * 56;
  const offset = circumference - (todayPct / 100) * circumference;
  document.getElementById('todayRing').style.strokeDashoffset = offset;
  document.getElementById('todayPercent').textContent = todayPct + '%';

  updatePhases();
  renderCalendar();
}

function updatePhases() {
  const dayNum = getDayNumber();
  
  // Phase 1: days 1-30
  const p1 = Math.min(Math.max(dayNum - 1, 0), 30);
  document.getElementById('phase1Bar').style.width = (p1/30*100) + '%';
  document.getElementById('phase1Prog').textContent = p1 + ' / 30 ÙŠÙˆÙ…';
  
  // Phase 2: days 31-60
  const p2 = Math.min(Math.max(dayNum - 30, 0), 30);
  document.getElementById('phase2Bar').style.width = (p2/30*100) + '%';
  document.getElementById('phase2Prog').textContent = p2 + ' / 30 ÙŠÙˆÙ…';
  
  // Phase 3: days 61-90
  const p3 = Math.min(Math.max(dayNum - 60, 0), 30);
  document.getElementById('phase3Bar').style.width = (p3/30*100) + '%';
  document.getElementById('phase3Prog').textContent = p3 + ' / 30 ÙŠÙˆÙ…';

  // Current phase in dashboard
  let phase, phaseName, phaseDesc, phaseVal, phaseMax;
  if (dayNum <= 30) {
    phase = 1; phaseName = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 â€” Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª';
    phaseDesc = 'PHP + WordPress Core + Hooks & Filters';
    phaseVal = p1; phaseMax = 30;
  } else if (dayNum <= 60) {
    phase = 2; phaseName = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2 â€” Ø§Ù„ØªØ·ÙˆÙŠØ±';
    phaseDesc = 'WooCommerce + REST API + Performance';
    phaseVal = p2; phaseMax = 30;
  } else {
    phase = 3; phaseName = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3 â€” Ø§Ù„Ø§Ø­ØªØ±Ø§Ù';
    phaseDesc = 'Portfolio + Case Studies + Freelance';
    phaseVal = p3; phaseMax = 30;
  }
  
  if (document.getElementById('phaseName')) {
    document.getElementById('phaseName').textContent = phaseName;
    document.getElementById('phaseDesc').textContent = phaseDesc;
    document.getElementById('phaseBar').style.width = (phaseVal/phaseMax*100) + '%';
    document.getElementById('phaseProgress').textContent = phaseVal + ' / ' + phaseMax + ' ÙŠÙˆÙ…';
  }
}

// ==================== CALENDAR ====================
function renderCalendar() {
  const grid = document.getElementById('calendarGrid');
  if (!grid) return;
  
  const start = new Date(state.startDate || new Date());
  const today = new Date();
  today.setHours(0,0,0,0);
  const dayNum = getDayNumber();
  
  let html = '';
  const limit = currentView === 'week' ? Math.min(dayNum + 6, 90) : 90;
  const from = currentView === 'week' ? Math.max(1, dayNum - 6) : 1;
  
  for (let i = from; i <= limit; i++) {
    const d = new Date(start);
    d.setDate(d.getDate() + i - 1);
    d.setHours(0,0,0,0);
    const key = d.toISOString().split('T')[0];
    const data = state.days[key];
    const isToday = d.getTime() === today.getTime();
    
    let cls = 'day-cell';
    if (isToday) cls += ' today';
    
    if (data) {
      const total = state.habits.filter(h => h.active).length;
      const done = Object.values(data.habits).filter(Boolean).length;
      const ratio = total > 0 ? done / total : 0;
      if (ratio >= 0.8) cls += ' done-day';
      else if (ratio > 0) cls += ' partial';
    }
    
    html += `<div class="${cls}" title="ÙŠÙˆÙ… ${i}" onclick="showDaySummary('${key}', ${i})">${i}</div>`;
  }
  grid.innerHTML = html;
}

function switchView(v) {
  currentView = v;
  document.getElementById('viewWeek').classList.toggle('active', v === 'week');
  document.getElementById('viewFull').classList.toggle('active', v === 'full');
  renderCalendar();
}

// ==================== TODAY ====================
function renderToday() {
  const key = getTodayKey();
  const data = getDayData(key);
  const dayNum = getDayNumber();
  
  // Date display
  const now = new Date();
  const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
  const months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  document.getElementById('todayDate').textContent = `${days[now.getDay()]}ØŒ ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
  document.getElementById('todayDayNum').textContent = Math.min(dayNum, 90);

  // Habits
  const list = document.getElementById('habitsList');
  const activeHabits = state.habits.filter(h => h.active);
  const doneCount = activeHabits.filter(h => data.habits[h.id]).length;
  document.getElementById('habitsCount').textContent = `${doneCount}/${activeHabits.length}`;
  
  list.innerHTML = activeHabits.map(h => `
    <div class="habit-item ${data.habits[h.id] ? 'done' : ''}" onclick="toggleHabit(${h.id})">
      <div class="habit-check">${data.habits[h.id] ? 'âœ“' : ''}</div>
      <span style="font-size:18px;">${h.emoji}</span>
      <span class="font-semibold flex-1">${h.name}</span>
      <button onclick="event.stopPropagation();removeHabit(${h.id})" style="background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:18px;">Ã—</button>
    </div>
  `).join('');

  // Note
  document.getElementById('todayNote').value = data.note || '';
  
  // Mood
  document.querySelectorAll('.mood-btn').forEach(btn => {
    btn.style.background = btn.textContent.trim() === data.mood ? 'rgba(255,255,255,0.1)' : 'transparent';
  });
}

function toggleHabit(id) {
  const key = getTodayKey();
  const data = getDayData(key);
  data.habits[id] = !data.habits[id];
  save();
  renderToday();
  updateDashboard();
  showToast(data.habits[id] ? 'âœ… ØªÙ…!' : 'â†© ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡');
}

function setMood(mood, el) {
  const key = getTodayKey();
  getDayData(key).mood = mood;
  save();
  document.querySelectorAll('.mood-btn').forEach(b => b.style.background = 'transparent');
  el.style.background = 'rgba(255,255,255,0.1)';
}

function saveTodayNote() {
  const key = getTodayKey();
  getDayData(key).note = document.getElementById('todayNote').value;
  save();
}

function saveDay() {
  saveTodayNote();
  save();
  updateDashboard();
  showToast('ğŸ’¾ ØªÙ… Ø­ÙØ¸ ÙŠÙˆÙ…Ùƒ!');
}

// ==================== HABITS ====================
function openAddHabit() {
  document.getElementById('addHabitModal').style.display = 'flex';
}

function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}

function pickEmoji(el) {
  selectedEmoji = el.textContent.trim();
  document.getElementById('newHabitEmoji').value = selectedEmoji;
  document.querySelectorAll('.emoji-pick').forEach(e => e.style.background = 'transparent');
  el.style.background = 'rgba(108,99,255,0.2)';
}

function addHabit() {
  const name = document.getElementById('newHabitName').value.trim();
  const emoji = document.getElementById('newHabitEmoji').value.trim() || selectedEmoji;
  if (!name) { showToast('âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©'); return; }
  
  const id = Date.now();
  state.habits.push({ id, name, emoji, active: true });
  save();
  closeModal('addHabitModal');
  renderToday();
  document.getElementById('newHabitName').value = '';
  showToast('âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
}

function removeHabit(id) {
  state.habits = state.habits.filter(h => h.id !== id);
  save();
  renderToday();
}

// ==================== PROGRESS ====================
function renderProgress() {
  const dayNum = getDayNumber();
  const streak = calculateStreak();
  const best = calculateBestStreak();
  
  document.getElementById('progTotal').textContent = Object.keys(state.days).length;
  document.getElementById('progBest').textContent = best;
  
  const allPcts = Object.values(state.days).map(d => {
    const total = state.habits.filter(h => h.active).length;
    const done = Object.values(d.habits).filter(Boolean).length;
    return total > 0 ? (done / total) * 100 : 0;
  });
  const avg = allPcts.length ? Math.round(allPcts.reduce((a,b) => a+b, 0) / allPcts.length) : 0;
  document.getElementById('progAvg').textContent = avg + '%';

  // Full calendar
  const start = new Date(state.startDate || new Date());
  const today = new Date(); today.setHours(0,0,0,0);
  let html = '';
  
  for (let i = 1; i <= 90; i++) {
    const d = new Date(start);
    d.setDate(d.getDate() + i - 1);
    d.setHours(0,0,0,0);
    const key = d.toISOString().split('T')[0];
    const data = state.days[key];
    const isToday = d.getTime() === today.getTime();
    
    let cls = 'day-cell';
    if (isToday) cls += ' today';
    if (data) {
      const total = state.habits.filter(h => h.active).length;
      const done = Object.values(data.habits).filter(Boolean).length;
      const ratio = total > 0 ? done / total : 0;
      if (ratio >= 0.8) cls += ' done-day';
      else if (ratio > 0) cls += ' partial';
    }
    html += `<div class="${cls}" title="ÙŠÙˆÙ… ${i}" style="width:30px;height:30px;font-size:10px;">${i}</div>`;
  }
  document.getElementById('fullCalendar').innerHTML = html;

  // Journal
  const journalEntries = Object.entries(state.days)
    .filter(([k, d]) => d.note)
    .sort(([a],[b]) => b.localeCompare(a))
    .slice(0, 5);
  
  if (journalEntries.length === 0) {
    document.getElementById('journalList').innerHTML = `<p style="color:var(--muted);text-align:center;padding:20px;">Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ù…Ù„Ø§Ø­Ø¸Ø§Øª. Ø³Ø¬Ù‘Ù„ ÙŠÙˆÙ…Ùƒ Ø§Ù„Ø£ÙˆÙ„! âœï¸</p>`;
  } else {
    document.getElementById('journalList').innerHTML = journalEntries.map(([key, data]) => {
      const d = new Date(key);
      const dayNum = state.startDate ? Math.floor((d - new Date(state.startDate)) / 86400000) + 1 : '-';
      return `
        <div style="padding:16px;background:var(--surface2);border:1px solid var(--border);border-radius:14px;">
          <div class="flex items-center gap-3 mb-2">
            <span class="text-lg">${data.mood || 'ğŸ“…'}</span>
            <span class="font-bold text-sm" style="color:var(--accent);">ÙŠÙˆÙ… ${dayNum}</span>
            <span class="text-xs" style="color:var(--muted);">${key}</span>
          </div>
          <p class="text-sm" style="color:var(--text);line-height:1.7;">${data.note}</p>
        </div>
      `;
    }).join('');
  }
}

// ==================== TIMER ====================
function setTimer() {
  const mins = parseInt(document.getElementById('timerSelect').value);
  timerSeconds = mins * 60;
  resetTimer();
}

function toggleTimer() {
  if (timerRunning) {
    clearInterval(timerInterval);
    timerRunning = false;
    document.getElementById('timerBtn').textContent = 'â–¶ Ø§Ø³ØªÙƒÙ…Ù„';
  } else {
    timerRunning = true;
    document.getElementById('timerBtn').textContent = 'â¸ ÙˆÙ‚Ù';
    timerInterval = setInterval(() => {
      if (timerSeconds <= 0) {
        clearInterval(timerInterval);
        timerRunning = false;
        document.getElementById('timerBtn').textContent = 'â–¶ Ø§Ø¨Ø¯Ø£';
        showToast('ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©! Ø¹Ø¸ÙŠÙ…');
        return;
      }
      timerSeconds--;
      updateTimerDisplay();
    }, 1000);
  }
}

function resetTimer() {
  clearInterval(timerInterval);
  timerRunning = false;
  const mins = parseInt(document.getElementById('timerSelect').value);
  timerSeconds = mins * 60;
  document.getElementById('timerBtn').textContent = 'â–¶ Ø§Ø¨Ø¯Ø£';
  updateTimerDisplay();
}

function updateTimerDisplay() {
  const m = Math.floor(timerSeconds / 60);
  const s = timerSeconds % 60;
  document.getElementById('timerDisplay').textContent = 
    String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
}

// ==================== EXPORT ====================
function exportData() {
  const json = JSON.stringify(state, null, 2);
  const blob = new Blob([json], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `nafis_backup_${getTodayKey()}.json`;
  a.click();
  showToast('ğŸ“¤ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±!');
}

// ==================== TOAST ====================
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.style.transform = 'translateX(-50%) translateY(0)';
  setTimeout(() => { toast.style.transform = 'translateX(-50%) translateY(80px)'; }, 2500);
}

// ==================== START ====================
init();
</script>
</body>
</html>